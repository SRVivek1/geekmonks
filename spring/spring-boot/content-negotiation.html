<!DOCTYPE html>
<html lang="en">

<!-- HTML Head-->
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet">
    <link rel="stylesheet" href="/geekmonks/assets/css/styles.css">
    <link type="application/atom+xml" rel="alternate" href="https://srvivek1.github.io/geekmonks/feed.xml" title="Geekmonks Blog" />
    <!-- Begin Jekyll SEO tag v2.8.0 -->
<title>üìù Content Negotation | Geekmonks Blog</title>
<meta name="generator" content="Jekyll v3.10.0" />
<meta property="og:title" content="üìù Content Negotation" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Content Negotiation is a crucial mechanism in web services, allowing a single resource to be available in multiple representations (e.g., JSON, XML). This section explores how it works and how Spring Boot simplifies its implementation." />
<meta property="og:description" content="Content Negotiation is a crucial mechanism in web services, allowing a single resource to be available in multiple representations (e.g., JSON, XML). This section explores how it works and how Spring Boot simplifies its implementation." />
<link rel="canonical" href="https://srvivek1.github.io/geekmonks/spring/spring-boot/content-negotiation.html" />
<meta property="og:url" content="https://srvivek1.github.io/geekmonks/spring/spring-boot/content-negotiation.html" />
<meta property="og:site_name" content="Geekmonks Blog" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2024-11-02T00:00:00+05:30" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="üìù Content Negotation" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2024-11-02T00:00:00+05:30","datePublished":"2024-11-02T00:00:00+05:30","description":"Content Negotiation is a crucial mechanism in web services, allowing a single resource to be available in multiple representations (e.g., JSON, XML). This section explores how it works and how Spring Boot simplifies its implementation.","headline":"üìù Content Negotation","mainEntityOfPage":{"@type":"WebPage","@id":"https://srvivek1.github.io/geekmonks/spring/spring-boot/content-negotiation.html"},"url":"https://srvivek1.github.io/geekmonks/spring/spring-boot/content-negotiation.html"}</script>
<!-- End Jekyll SEO tag -->

    <!-- Google Analytics -->
    <!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-48XEHMVSEC"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-48XEHMVSEC');
</script>
</head>

<body class="container-fluid p-0 m-0">
    <header>
        <nav class="navbar navbar-expand-md navbar-light bg-light text-white content-shadow">
  <div class="container d-flex justify-content-between">
    <a href="/geekmonks/" class="navbar-brand d-flex">
      <img class="d-inline-block align-top" src="/geekmonks/assets/icons/laptop.svg" height="40"
        width="34" />
      <h1 class="fs-3 px-2 fw-bold">Geekmonks</h1>
      <img class="d-inline-block align-top" src="/geekmonks/assets/icons/tux.svg" height="40"
        width="34" />
    </a>
    <!-- Toggle Button to expand and collapse the nav links -->
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNavBanner"
      aria-controls="navbarNavBanner" aria-expanded="false" aria-label="Toggle Navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbarNavBanner" class="collapse navbar-collapse">
      <ul class="navbar-nav ms-auto">
        
        <li class="nav-item active">
          <a href="/geekmonks/" class="nav-link fw-bold active"
            >Home</a>
        </li>
        
        <li class="nav-item active">
          <a href="/geekmonks/blog" class="nav-link fw-bold active"
            >Blog</a>
        </li>
        
        <li class="nav-item active">
          <a href="/geekmonks/about" class="nav-link fw-bold active"
            >About</a>
        </li>
        
        <li class="nav-item active">
          <a href="/geekmonks/staff" class="nav-link fw-bold active"
            >Staff</a>
        </li>
        
        <li class="nav-item active">
          <a href="https://github.com/SRVivek1/" class="nav-link fw-bold active"
            target="_blank" rel="noopener noreferrer">Github</a>
        </li>
        
        <li class="nav-item active">
          <a href="https://www.linkedin.com/in/srvivek1/" class="nav-link fw-bold active"
            target="_blank" rel="noopener noreferrer">LinkedIn</a>
        </li>
        
      </ul>
    </div>
  </div>
</nav>
        <nav class="navbar navbar-expand-xl navbar-custom p-0">
  <div class="container-fluid">

    <!-- Toggler for small screens -->
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <!-- Collapsible nav items -->
    <div class="collapse navbar-collapse" id="navbarNav">
      <ul class="navbar-nav mx-auto">
        
          
          
            
              <!-- Simple nav item -->
              <li class="nav-item">
                <a class="nav-link fw-bold text-white" href="/geekmonks/ai-ml/llm-engineering/"
                  >AI-ML</a>
              </li>
            
          
            
              <!-- Simple nav item -->
              <li class="nav-item">
                <a class="nav-link fw-bold text-white" href="/geekmonks/cloud/aws/"
                  >AWS</a>
              </li>
            
          
            
              <!-- Simple nav item -->
              <li class="nav-item">
                <a class="nav-link fw-bold text-white" href="/geekmonks/spring/spring-boot/"
                  >Spring Boot</a>
              </li>
            
          
        
      </ul>
    </div>
  </div>
</nav>
    </header>

    <div class="container-fluid">
        <div class="row min-vh-100">
            <!-- Left Sidebar -->
            <nav id="course-sidebar" class="col-md-3 col-lg-2 d-md-block bg-light sidebar collapse">
                <div class="position-sticky pt-3">
                    <ul class="nav flex-column course-topics-list">
                        
                        
                        
                        
                        <a class="nav-link course-link active"
                            href="/geekmonks/spring/spring-boot" data-course="spring/spring-boot">
                            Spring Boot
                        </a>
                        <!-- Debug - Submenu links are broken -->
                        
                        <ul class="nav flex-column ms-3 subtopics" id="topics-spring-spring-boot">
                            
                            <li class="nav-item">
                                <a class="nav-link topic-link small" href="getting-started.html"
                                    data-topic="getting-started.html"
                                    data-course-path="/spring/spring-boot">
                                    Controllers - Getting Started
                                </a>
                            </li>
                            
                            <li class="nav-item">
                                <a class="nav-link topic-link small" href="rest-api-validation.html"
                                    data-topic="rest-api-validation.html"
                                    data-course-path="/spring/spring-boot">
                                    API Validation
                                </a>
                            </li>
                            
                            <li class="nav-item">
                                <a class="nav-link topic-link small" href="swagger-api-doc.html"
                                    data-topic="swagger-api-doc.html"
                                    data-course-path="/spring/spring-boot">
                                    Swagger API Documentation
                                </a>
                            </li>
                            
                            <li class="nav-item">
                                <a class="nav-link topic-link small" href="content-negotiation.html"
                                    data-topic="content-negotiation.html"
                                    data-course-path="/spring/spring-boot">
                                    Content Negotiation
                                </a>
                            </li>
                            
                            <li class="nav-item">
                                <a class="nav-link topic-link small" href="i18n.html"
                                    data-topic="i18n.html"
                                    data-course-path="/spring/spring-boot">
                                    Internationalization (i18n)
                                </a>
                            </li>
                            
                            <li class="nav-item">
                                <a class="nav-link topic-link small" href="rest-api-versioning.html"
                                    data-topic="rest-api-versioning.html"
                                    data-course-path="/spring/spring-boot">
                                    Rest API Versioning
                                </a>
                            </li>
                            
                            <li class="nav-item">
                                <a class="nav-link topic-link small" href="rest-api-retirement.html"
                                    data-topic="rest-api-retirement.html"
                                    data-course-path="/spring/spring-boot">
                                    API Retirement Strategy
                                </a>
                            </li>
                            
                            <li class="nav-item">
                                <a class="nav-link topic-link small" href="hateoas.html"
                                    data-topic="hateoas.html"
                                    data-course-path="/spring/spring-boot">
                                    HATEOAS
                                </a>
                            </li>
                            
                            <li class="nav-item">
                                <a class="nav-link topic-link small" href="static-content-filtering.html"
                                    data-topic="static-content-filtering.html"
                                    data-course-path="/spring/spring-boot">
                                    Static Content Filtering
                                </a>
                            </li>
                            
                            <li class="nav-item">
                                <a class="nav-link topic-link small" href="dynamic-content-filtering.html"
                                    data-topic="dynamic-content-filtering.html"
                                    data-course-path="/spring/spring-boot">
                                    Dynamic Content Filtering
                                </a>
                            </li>
                            
                            <li class="nav-item">
                                <a class="nav-link topic-link small" href="client-driven-filtering.html"
                                    data-topic="client-driven-filtering.html"
                                    data-course-path="/spring/spring-boot">
                                    Client-Driven Filtering
                                </a>
                            </li>
                            
                            <li class="nav-item">
                                <a class="nav-link topic-link small" href="exception-error-handling.html"
                                    data-topic="exception-error-handling.html"
                                    data-course-path="/spring/spring-boot">
                                    Controller Error Handling
                                </a>
                            </li>
                            
                            <li class="nav-item">
                                <a class="nav-link topic-link small" href="hal-explorer.html"
                                    data-topic="hal-explorer.html"
                                    data-course-path="/spring/spring-boot">
                                    HAL Explorer
                                </a>
                            </li>
                            
                            <li class="nav-item">
                                <a class="nav-link topic-link small" href="jpa-with-h2-db.html"
                                    data-topic="jpa-with-h2-db.html"
                                    data-course-path="/spring/spring-boot">
                                    JPA with H2 DB
                                </a>
                            </li>
                            
                            <li class="nav-item">
                                <a class="nav-link topic-link small" href="jpa-with-mysql-db.html"
                                    data-topic="jpa-with-mysql-db.html"
                                    data-course-path="/spring/spring-boot">
                                    JPA with MySQL DB
                                </a>
                            </li>
                            
                            <li class="nav-item">
                                <a class="nav-link topic-link small" href="jpa-jdbc-template.html"
                                    data-topic="jpa-jdbc-template.html"
                                    data-course-path="/spring/spring-boot">
                                    JPA & JDBC Teamplate
                                </a>
                            </li>
                            
                            <li class="nav-item">
                                <a class="nav-link topic-link small" href="spring-security-basics.html"
                                    data-topic="spring-security-basics.html"
                                    data-course-path="/spring/spring-boot">
                                    Spring Security
                                </a>
                            </li>
                            
                        </ul>
                        
                        
                        
                        
                        
                        
                    </ul>
                </div>
            </nav>

            <!-- Right Content Panel -->
            <main class="col-md-9 ms-sm-auto col-lg-10 px-md-4">
                <!-- Mobile: toggle sidebar button -->
                <button id="sidebarToggle" class="btn btn-sm btn-outline-secondary d-md-none mb-2"
                    aria-label="Toggle topics" aria-controls="course-sidebar">
                    ‚ò∞ Topics
                </button>



                <div id="topic-content">
                    <div id="pageTitle">
                        <h1>üìù Content Negotation</h1>
                        <p>
                            Updated on: 02 Nov 2024

                            
                            
                            - <a href="/geekmonks/authors/srvivek/">Vivek Singh</a>
                            
                        </p>

                        <hr class="stylish-hr"/>
                    </div>

                    <p>Content Negotiation is a crucial mechanism in web services, allowing a single resource to be available in multiple representations (e.g., JSON, XML). This section explores how it works and how Spring Boot simplifies its implementation.</p>

<hr />

<h2 id="-table-of-contents">üß≠ Table of Contents</h2>

<ul>
  <li><a href="#-table-of-contents">üß≠ Table of Contents</a></li>
  <li><a href="#-what-is-content-negotiation">ü§î What is Content Negotiation?</a></li>
  <li><a href="#-how-content-negotiation-is-achieved-in-spring-boot">üöÄ How Content Negotiation is Achieved in Spring Boot</a></li>
  <li><a href="#Ô∏è-project-setup-and-dependencies">üõ†Ô∏è Project Setup and Dependencies</a>
    <ul>
      <li><a href="#maven--external-dependency">Maven / External Dependency</a></li>
    </ul>
  </li>
  <li><a href="#-proof-of-concept-poc-application">üíª Proof of Concept (POC) Application</a>
    <ul>
      <li><a href="#model-class-product">Model Class: <code class="language-plaintext highlighter-rouge">Product</code></a></li>
      <li><a href="#controller-class-productcontroller">Controller Class: <code class="language-plaintext highlighter-rouge">ProductController</code></a></li>
      <li><a href="#testing-the-poc">Testing the POC</a></li>
      <li><a href="#reference-poc-project">Reference POC Project:</a></li>
    </ul>
  </li>
  <li><a href="#-content-transformation-flow-diagram">üåä Content Transformation Flow (Diagram)</a></li>
  <li><a href="#-testing-content-negotiation-with-curl">üß™ Testing Content Negotiation with cURL</a>
    <ul>
      <li><a href="#1-requesting-json-format">1. Requesting JSON Format</a></li>
      <li><a href="#2-requesting-xml-format">2. Requesting XML Format</a></li>
    </ul>
  </li>
  <li><a href="#-the-406-not-acceptable-error-scenario">üõë The <code class="language-plaintext highlighter-rouge">406 Not Acceptable</code> Error Scenario</a></li>
  <li><a href="#Ô∏è-how-to-enforce-strict-content-negotiation-in-spring-boot">üõ†Ô∏è How to Enforce Strict Content Negotiation in Spring Boot</a>
    <ul>
      <li><a href="#configuration-example-java">Configuration Example (Java)</a></li>
    </ul>
  </li>
  <li><a href="#-testing-the-406-scenario">üéØ Testing the <code class="language-plaintext highlighter-rouge">406</code> Scenario</a>
    <ul>
      <li><a href="#requesting-unsupported-format-eg-yaml">Requesting Unsupported Format (e.g., YAML)</a></li>
    </ul>
  </li>
  <li><a href="#-406-not-acceptable-vs-415-unsupported-media-type">üÜö <code class="language-plaintext highlighter-rouge">406 Not Acceptable</code> vs. <code class="language-plaintext highlighter-rouge">415 Unsupported Media Type</code></a>
    <ul>
      <li><a href="#1--406-not-acceptable-the-response-problem">1. üõë <code class="language-plaintext highlighter-rouge">406 Not Acceptable</code> (The Response Problem)</a></li>
      <li><a href="#2-Ô∏è-415-unsupported-media-type-the-request-problem">2. ‚ö†Ô∏è <code class="language-plaintext highlighter-rouge">415 Unsupported Media Type</code> (The Request Problem)</a></li>
    </ul>
  </li>
  <li><a href="#-developer-insights-and-best-practices">üí° Developer Insights and Best Practices</a>
    <ul>
      <li><a href="#key-points-developers-should-be-aware-of">Key Points Developers Should Be Aware Of</a></li>
    </ul>
  </li>
</ul>

<hr />

<h2 id="-what-is-content-negotiation">ü§î What is Content Negotiation?</h2>

<p>Content negotiation is the process of selecting the <strong>best representation</strong> for a given response when multiple representations are available. It primarily involves the client and server agreeing on the format for exchanging data.</p>

<ul>
  <li><strong>How it Works:</strong>
    <ul>
      <li>The client sends an <strong><code class="language-plaintext highlighter-rouge">Accept</code></strong> header (e.g., <code class="language-plaintext highlighter-rouge">Accept: application/json</code> or <code class="language-plaintext highlighter-rouge">Accept: application/xml</code>) in its request, indicating the media types it can process.</li>
      <li>The server examines this header and attempts to return the resource in one of the requested formats. If no preferred format is specified by the client, the server typically defaults to a predetermined format, often <strong>JSON</strong>.</li>
    </ul>
  </li>
  <li><strong>Identifying Content Types:</strong>
    <ul>
      <li><strong>Request Type:</strong> Identified by the client‚Äôs <strong><code class="language-plaintext highlighter-rouge">Accept</code></strong> header, which specifies the <strong>response</strong> type the client <em>wants</em>.</li>
      <li><strong>Returning Type:</strong> Identified by the server‚Äôs <strong><code class="language-plaintext highlighter-rouge">Content-Type</code></strong> header in the response, which specifies the actual format of the <strong>data being returned</strong>.</li>
    </ul>
  </li>
</ul>

<hr />

<h2 id="-how-content-negotiation-is-achieved-in-spring-boot">üöÄ How Content Negotiation is Achieved in Spring Boot</h2>

<p>Spring Boot, leveraging <strong>Spring Web MVC</strong>, makes content negotiation largely automatic through its <strong><code class="language-plaintext highlighter-rouge">HttpMessageConverter</code></strong> mechanism.</p>

<ul>
  <li><strong>Supported Content Types:</strong>
    <ul>
      <li>Spring Boot natively supports many formats. For converting Java objects to and from data formats, the primary types are <strong>JSON</strong> (via Jackson) and <strong>XML</strong>.</li>
      <li>Support for other types like plain text or byte streams is also available. To support a new format like XML, you just need to add the appropriate dependency; Spring Boot handles the wiring.</li>
    </ul>
  </li>
  <li>
    <p><strong>Automatic vs. Manual Config:</strong></p>

    <ul>
      <li><strong>Automatic:</strong> In most cases, it‚Äôs <strong>automatic</strong>. By default, Spring Boot uses the <strong><code class="language-plaintext highlighter-rouge">Accept</code></strong> header approach. If the client requests <code class="language-plaintext highlighter-rouge">Accept: application/xml</code> and the required XML library is present, Spring automatically selects the appropriate <strong><code class="language-plaintext highlighter-rouge">HttpMessageConverter</code></strong> (e.g., <strong><code class="language-plaintext highlighter-rouge">MappingJackson2XmlHttpMessageConverter</code></strong>) to serialize the Java object to XML.</li>
      <li><strong>Manual/Custom:</strong> You can manually configure it, for example, by using <strong>URL suffixes</strong> (<code class="language-plaintext highlighter-rouge">/resource.xml</code>), <strong>query parameters</strong> (<code class="language-plaintext highlighter-rouge">/resource?format=xml</code>), or overriding the default converters and strategies via <code class="language-plaintext highlighter-rouge">WebMvcConfigurer</code>.
        <ul>
          <li>However, relying on the <strong><code class="language-plaintext highlighter-rouge">Accept</code></strong> header is the <strong>REST standard</strong> and is recommended.</li>
        </ul>
      </li>
    </ul>
  </li>
</ul>

<hr />

<h2 id="Ô∏è-project-setup-and-dependencies">üõ†Ô∏è Project Setup and Dependencies</h2>

<p>In our application, we need to ensure that the server can handle XML serialization in addition to the <strong><code class="language-plaintext highlighter-rouge">default JSON</code></strong>.</p>

<h3 id="maven--external-dependency">Maven / External Dependency</h3>

<p>Add the following dependency to your <code class="language-plaintext highlighter-rouge">pom.xml</code> file. This library is required for converting Java objects to XML format.</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;dependency&gt;</span>
    <span class="nt">&lt;groupId&gt;</span>com.fasterxml.jackson.dataformat<span class="nt">&lt;/groupId&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>jackson-dataformat-xml<span class="nt">&lt;/artifactId&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
</code></pre></div></div>

<blockquote>
  <p><strong>Note:</strong>
If the client requests for <code class="language-plaintext highlighter-rouge">Accept: application/xml</code> header, <strong>Spring</strong> will internally check for the <code class="language-plaintext highlighter-rouge">jackson-dataformat-xml</code> API dependency. If found, the Java bean will be automatically transformed to <strong>XML</strong> using the <strong><code class="language-plaintext highlighter-rouge">MappingJackson2XmlHttpMessageConverter</code></strong>.</p>
</blockquote>

<hr />

<h2 id="-proof-of-concept-poc-application">üíª Proof of Concept (POC) Application</h2>

<p>The beauty of Spring Boot‚Äôs content negotiation is that <strong>no code changes</strong> are required in the controller for this basic functionality. The core logic resides in a simple <strong>REST Controller</strong> that returns a standard Java object.</p>

<h3 id="model-class-product">Model Class: <code class="language-plaintext highlighter-rouge">Product</code></h3>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="nn">com.example.model</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Product</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">;</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">name</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kt">double</span> <span class="n">price</span><span class="o">;</span>

    <span class="c1">// Constructors, Getters, and Setters</span>
    <span class="kd">public</span> <span class="nf">Product</span><span class="o">()</span> <span class="o">{}</span>

    <span class="kd">public</span> <span class="nf">Product</span><span class="o">(</span><span class="nc">Long</span> <span class="n">id</span><span class="o">,</span> <span class="nc">String</span> <span class="n">name</span><span class="o">,</span> <span class="kt">double</span> <span class="n">price</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">id</span> <span class="o">=</span> <span class="n">id</span><span class="o">;</span>
        <span class="k">this</span><span class="o">.</span><span class="na">name</span> <span class="o">=</span> <span class="n">name</span><span class="o">;</span>
        <span class="k">this</span><span class="o">.</span><span class="na">price</span> <span class="o">=</span> <span class="n">price</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="nc">Long</span> <span class="nf">getId</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">id</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setId</span><span class="o">(</span><span class="nc">Long</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">id</span> <span class="o">=</span> <span class="n">id</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="nc">String</span> <span class="nf">getName</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">name</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setName</span><span class="o">(</span><span class="nc">String</span> <span class="n">name</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">name</span> <span class="o">=</span> <span class="n">name</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">double</span> <span class="nf">getPrice</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">price</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setPrice</span><span class="o">(</span><span class="kt">double</span> <span class="n">price</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">price</span> <span class="o">=</span> <span class="n">price</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<h3 id="controller-class-productcontroller">Controller Class: <code class="language-plaintext highlighter-rouge">ProductController</code></h3>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="nn">com.example.controller</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.example.model.Product</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.GetMapping</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.RestController</span><span class="o">;</span>

<span class="nd">@RestController</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ProductController</span> <span class="o">{</span>

    <span class="nd">@GetMapping</span><span class="o">(</span><span class="s">"/api/product"</span><span class="o">)</span>
    <span class="kd">public</span> <span class="nc">Product</span> <span class="nf">getProduct</span><span class="o">()</span> <span class="o">{</span>
        <span class="c1">// This single method can return JSON or XML based on the Accept header</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nf">Product</span><span class="o">(</span><span class="mi">101L</span><span class="o">,</span> <span class="s">"Laptop"</span><span class="o">,</span> <span class="mf">1200.50</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<h3 id="testing-the-poc">Testing the POC</h3>

<table>
  <thead>
    <tr>
      <th style="text-align: left">Client Request Header</th>
      <th style="text-align: left">Expected Response Format</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left"><code class="language-plaintext highlighter-rouge">Accept: application/json</code></td>
      <td style="text-align: left"><strong>JSON</strong></td>
    </tr>
    <tr>
      <td style="text-align: left"><code class="language-plaintext highlighter-rouge">Accept: application/xml</code></td>
      <td style="text-align: left"><strong>XML</strong></td>
    </tr>
  </tbody>
</table>

<p><br /></p>

<h3 id="reference-poc-project">Reference POC Project:</h3>
<p>You can view the source code for this setup on Github: <a href="https://github.com/SRVivek1/springboot-microservices-2024/tree/main/a5-sboot-ms-content-negotiation">Content Negotiation POC</a></p>

<hr />

<h2 id="-content-transformation-flow-diagram">üåä Content Transformation Flow (Diagram)</h2>

<p>The following Mermaid diagram illustrates the automatic content negotiation flow in a Spring Boot application.</p>

<pre><code class="language-mermaid">sequenceDiagram
    participant C as Client
    participant SB as Spring Boot Application
    participant Disp as DispatcherServlet
    participant Conv as HttpMessageConverter (e.g., Jackson JSON/XML)

    C-&gt;&gt;SB: HTTP GET /api/product (Header: Accept: application/xml)
    SB-&gt;&gt;Disp: Request received
    Disp-&gt;&gt;Disp: Finds @GetMapping("/api/product") handler
    Disp-&gt;&gt;SB: Calls ProductController.getProduct()
    SB--&gt;&gt;Disp: Returns Product Java Object
    Disp-&gt;&gt;Disp: Determines return type is Product
    Disp-&gt;&gt;Disp: Checks client's Accept header (application/xml)
    Disp-&gt;&gt;Conv: Selects MappingJackson2XmlHttpMessageConverter
    Conv-&gt;&gt;Disp: Converts Product Object to XML String
    Disp--&gt;&gt;SB: Returns XML Response
    SB--&gt;&gt;C: HTTP 200 OK (Header: Content-Type: application/xml)

    C-&gt;&gt;SB: HTTP GET /api/product (Header: Accept: application/json)
    SB-&gt;&gt;Disp: Request received
    Disp-&gt;&gt;Disp: Checks client's Accept header (application/json)
    Disp-&gt;&gt;Conv: Selects MappingJackson2HttpMessageConverter
    Conv-&gt;&gt;Disp: Converts Product Object to JSON String
    Disp--&gt;&gt;SB: Returns JSON Response
    SB--&gt;&gt;C: HTTP 200 OK (Header: Content-Type: application/json)
</code></pre>

<hr />

<h2 id="-testing-content-negotiation-with-curl">üß™ Testing Content Negotiation with cURL</h2>

<p>These commands demonstrate how the client‚Äôs <code class="language-plaintext highlighter-rouge">Accept</code> header dictates the format of the server‚Äôs response (JSON or XML). Assume your Spring Boot application is running locally on port <code class="language-plaintext highlighter-rouge">8080</code>.</p>

<h3 id="1-requesting-json-format">1. Requesting JSON Format</h3>

<p>This is the standard request. We explicitly set the <code class="language-plaintext highlighter-rouge">Accept</code> header to <code class="language-plaintext highlighter-rouge">application/json</code>. The server should respond with a JSON payload.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># cURL command for requesting JSON</span>
curl <span class="nt">-X</span> GET http://localhost:8080/api/product <span class="se">\</span>
<span class="nt">-H</span> <span class="s1">'Accept: application/json'</span> <span class="se">\</span>
<span class="nt">-i</span>
</code></pre></div></div>

<p><strong>Expected JSON Response Body:</strong></p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">101</span><span class="p">,</span><span class="w">
  </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Laptop"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"price"</span><span class="p">:</span><span class="w"> </span><span class="mf">1200.5</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p><br /></p>

<h3 id="2-requesting-xml-format">2. Requesting XML Format</h3>

<p>By changing the <code class="language-plaintext highlighter-rouge">Accept</code> header to <code class="language-plaintext highlighter-rouge">application/xml</code>, the Spring Boot application (with the <code class="language-plaintext highlighter-rouge">jackson-dataformat-xml</code> dependency) automatically serializes the <code class="language-plaintext highlighter-rouge">Product</code> object into XML.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># cURL command for requesting XML</span>
curl <span class="nt">-X</span> GET http://localhost:8080/api/product <span class="se">\</span>
<span class="nt">-H</span> <span class="s1">'Accept: application/xml'</span> <span class="se">\</span>
<span class="nt">-i</span>
</code></pre></div></div>

<p><strong>Expected XML Response Body:</strong></p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;Product&gt;</span>
    <span class="nt">&lt;id&gt;</span>101<span class="nt">&lt;/id&gt;</span>
    <span class="nt">&lt;name&gt;</span>Laptop<span class="nt">&lt;/name&gt;</span>
    <span class="nt">&lt;price&gt;</span>1200.5<span class="nt">&lt;/price&gt;</span>
<span class="nt">&lt;/Product&gt;</span>
</code></pre></div></div>

<hr />

<h2 id="-the-406-not-acceptable-error-scenario">üõë The <code class="language-plaintext highlighter-rouge">406 Not Acceptable</code> Error Scenario</h2>

<p>That‚Äôs a very practical and insightful! to understanding the <strong><code class="language-plaintext highlighter-rouge">406 Not Acceptable</code></strong> error is crucial for building robust APIs.</p>

<p>The <strong><code class="language-plaintext highlighter-rouge">406 Not Acceptable</code></strong> HTTP status code is a direct outcome of <strong>failed content negotiation</strong>. It is a clear signal from the server to the client that while the server has found the resource, it cannot provide a representation of that resource that is acceptable to the client, based on the criteria specified in the request.</p>

<ul>
  <li><strong>Definition:</strong> The server understands the content type requested in the client‚Äôs <strong><code class="language-plaintext highlighter-rouge">Accept</code></strong> header but <strong>does not have a resource converter or handler</strong> to generate a response in that specific format.</li>
  <li><strong>The Problem:</strong> The server cannot fulfill the requirement. For instance, the client might request <code class="language-plaintext highlighter-rouge">Accept: image/jpeg</code>, but the Spring Boot endpoint is designed only to return a Java object that can be serialized into JSON or XML.</li>
  <li><strong>Spring Boot‚Äôs Default Behavior:</strong> By default, Spring Web MVC is quite lenient. If a request is made with an <code class="language-plaintext highlighter-rouge">Accept</code> header for an unsupported type (e.g., <code class="language-plaintext highlighter-rouge">Accept: application/pdf</code>), Spring often attempts to fall back to its primary supported format, which is <strong>JSON</strong>. However, you can configure Spring Boot to strictly enforce the <strong><code class="language-plaintext highlighter-rouge">Accept</code></strong> header, which is where the <strong><code class="language-plaintext highlighter-rouge">406</code></strong> response becomes necessary.</li>
</ul>

<hr />

<h2 id="Ô∏è-how-to-enforce-strict-content-negotiation-in-spring-boot">üõ†Ô∏è How to Enforce Strict Content Negotiation in Spring Boot</h2>

<p>To ensure your API strictly adheres to the requested <code class="language-plaintext highlighter-rouge">Accept</code> header and returns a <code class="language-plaintext highlighter-rouge">406</code> when the format isn‚Äôt supported, you need to configure the <strong><code class="language-plaintext highlighter-rouge">ContentNegotiationConfigurer</code></strong> within your Spring application.</p>

<h3 id="configuration-example-java">Configuration Example (Java)</h3>

<p>You can achieve this by implementing the <code class="language-plaintext highlighter-rouge">WebMvcConfigurer</code> interface and overriding the <code class="language-plaintext highlighter-rouge">configureContentNegotiation</code> method. The key setting here is <strong><code class="language-plaintext highlighter-rouge">ignoreAcceptHeader(false)</code></strong> and <strong><code class="language-plaintext highlighter-rouge">defaultContentTypeStrategy(null)</code></strong> (or similar strict settings).</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">org.springframework.context.annotation.Configuration</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.http.MediaType</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.servlet.config.annotation.ContentNegotiationConfigurer</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.servlet.config.annotation.WebMvcConfigurer</span><span class="o">;</span>

<span class="nd">@Configuration</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">WebConfig</span> <span class="kd">implements</span> <span class="nc">WebMvcConfigurer</span> <span class="o">{</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">configureContentNegotiation</span><span class="o">(</span><span class="nc">ContentNegotiationConfigurer</span> <span class="n">configurer</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">// 1. Explicitly do NOT ignore the Accept header.</span>
        <span class="n">configurer</span><span class="o">.</span><span class="na">ignoreAcceptHeader</span><span class="o">(</span><span class="kc">false</span><span class="o">)</span>
                <span class="c1">// 2. Set the media types the server supports.</span>
                <span class="o">.</span><span class="na">mediaType</span><span class="o">(</span><span class="s">"json"</span><span class="o">,</span> <span class="nc">MediaType</span><span class="o">.</span><span class="na">APPLICATION_JSON</span><span class="o">)</span>
                <span class="o">.</span><span class="na">mediaType</span><span class="o">(</span><span class="s">"xml"</span><span class="o">,</span> <span class="nc">MediaType</span><span class="o">.</span><span class="na">APPLICATION_XML</span><span class="o">)</span>
                <span class="c1">// 3. Prevent automatic fallback to a default content type (like JSON).</span>
                <span class="c1">// If a requested type is not listed above, it will result in a 406.</span>
                <span class="o">.</span><span class="na">defaultContentType</span><span class="o">(</span><span class="nc">MediaType</span><span class="o">.</span><span class="na">APPLICATION_JSON</span><span class="o">);</span> <span class="c1">// Set a default only if Accept header is missing.</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<hr />

<h2 id="-testing-the-406-scenario">üéØ Testing the <code class="language-plaintext highlighter-rouge">406</code> Scenario</h2>

<p>If you configured Spring to strictly support only <code class="language-plaintext highlighter-rouge">application/json</code> and <code class="language-plaintext highlighter-rouge">application/xml</code>, here is the cURL command that would trigger the <code class="language-plaintext highlighter-rouge">406</code> error.</p>

<h3 id="requesting-unsupported-format-eg-yaml">Requesting Unsupported Format (e.g., YAML)</h3>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># cURL command requesting an unsupported format</span>
curl <span class="nt">-X</span> GET http://localhost:8080/api/product <span class="se">\</span>
<span class="nt">-H</span> <span class="s1">'Accept: application/yaml'</span> <span class="se">\</span>
<span class="nt">-i</span>
</code></pre></div></div>

<p><strong>Expected Response Headers:</strong></p>

<div class="language-http highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">406</span> <span class="ne">Not Acceptable</span>
<span class="na">Content-Type</span><span class="p">:</span> <span class="s">application/problem+json</span>
<span class="s">...</span>
</code></pre></div></div>

<p><strong>Developer Awareness:</strong></p>

<ul>
  <li><strong>Benefit of 406:</strong> Returning a <strong><code class="language-plaintext highlighter-rouge">406</code></strong> is good API etiquette. It explicitly tells the client, ‚ÄúI can‚Äôt serve the format you asked for,‚Äù preventing the client from trying to parse an unexpected format (e.g., XML when it expected YAML).</li>
  <li><strong>Server Support:</strong> A server <strong>must</strong> support the media type it lists in its <strong><code class="language-plaintext highlighter-rouge">Content-Type</code></strong> header for the response. If it cannot, the <strong><code class="language-plaintext highlighter-rouge">406</code></strong> is the appropriate response status.</li>
</ul>

<hr />

<h2 id="-406-not-acceptable-vs-415-unsupported-media-type">üÜö <code class="language-plaintext highlighter-rouge">406 Not Acceptable</code> vs. <code class="language-plaintext highlighter-rouge">415 Unsupported Media Type</code></h2>

<p>These two status codes refer to negotiation failures but relate to <strong>different parts</strong> of the HTTP request-response cycle:</p>

<table>
  <thead>
    <tr>
      <th style="text-align: left">Feature</th>
      <th style="text-align: left"><strong><code class="language-plaintext highlighter-rouge">406 Not Acceptable</code></strong></th>
      <th style="text-align: left"><strong><code class="language-plaintext highlighter-rouge">415 Unsupported Media Type</code></strong></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left"><strong>Request Part</strong></td>
      <td style="text-align: left"><strong><code class="language-plaintext highlighter-rouge">Accept</code></strong> header (Client $\to$ Server)</td>
      <td style="text-align: left"><strong><code class="language-plaintext highlighter-rouge">Content-Type</code></strong> header (Client $\to$ Server)</td>
    </tr>
    <tr>
      <td style="text-align: left"><strong>Flow Direction</strong></td>
      <td style="text-align: left"><strong>Response Content</strong> (What the server sends back)</td>
      <td style="text-align: left"><strong>Request Content</strong> (What the client sends to the server)</td>
    </tr>
    <tr>
      <td style="text-align: left"><strong>Meaning</strong></td>
      <td style="text-align: left">The server cannot generate a <strong>response</strong> representation that the <strong>client accepts</strong> (as specified in the <code class="language-plaintext highlighter-rouge">Accept</code> header).</td>
      <td style="text-align: left">The server cannot process the <strong>request payload</strong> because the format (specified in the <code class="language-plaintext highlighter-rouge">Content-Type</code> header) is <strong>not supported</strong>.</td>
    </tr>
    <tr>
      <td style="text-align: left"><strong>Example</strong></td>
      <td style="text-align: left">Client wants XML (<code class="language-plaintext highlighter-rouge">Accept: application/xml</code>), but the server can only produce JSON.</td>
      <td style="text-align: left">Client sends YAML data (<code class="language-plaintext highlighter-rouge">Content-Type: application/yaml</code>), but the server only accepts JSON for input.</td>
    </tr>
  </tbody>
</table>

<hr />

<h3 id="1--406-not-acceptable-the-response-problem">1. üõë <code class="language-plaintext highlighter-rouge">406 Not Acceptable</code> (The Response Problem)</h3>

<p>This code is used when the server cannot satisfy the client‚Äôs requirements for the <strong>response format</strong>.</p>

<ul>
  <li><strong>Request Role:</strong> It is governed by the client‚Äôs <strong><code class="language-plaintext highlighter-rouge">Accept</code></strong> header.</li>
  <li><strong>The Error:</strong> The client is saying, ‚ÄúI will only read X,‚Äù but the server only knows how to write Y and Z. Since Y and Z are not X, the negotiation fails.</li>
  <li><strong>In Spring Boot:</strong> This typically happens when the required serialization library is missing (e.g., no <code class="language-plaintext highlighter-rouge">jackson-dataformat-xml</code> to handle <code class="language-plaintext highlighter-rouge">Accept: application/xml</code>) <em>and</em> the server is configured to strictly enforce content negotiation.</li>
</ul>

<h3 id="2-Ô∏è-415-unsupported-media-type-the-request-problem">2. ‚ö†Ô∏è <code class="language-plaintext highlighter-rouge">415 Unsupported Media Type</code> (The Request Problem)</h3>

<p>This code is used when the server cannot understand or process the <strong>data format provided in the request payload</strong>.</p>

<ul>
  <li><strong>Request Role:</strong> It is governed by the client‚Äôs <strong><code class="language-plaintext highlighter-rouge">Content-Type</code></strong> header.</li>
  <li><strong>The Error:</strong> The client is sending data formatted as X (<code class="language-plaintext highlighter-rouge">Content-Type: X</code>), but the server endpoint only has a deserializer (an <code class="language-plaintext highlighter-rouge">HttpMessageConverter</code>) registered to read data formatted as Y. The server rejects the input immediately.</li>
  <li><strong>In Spring Boot:</strong> This commonly occurs in a <code class="language-plaintext highlighter-rouge">POST</code> or <code class="language-plaintext highlighter-rouge">PUT</code> request where:
    <ul>
      <li>The controller method expects a JSON body (the default).</li>
      <li>The client sends a request with the header <code class="language-plaintext highlighter-rouge">Content-Type: text/plain</code> and a non-text body. Spring fails to find a converter to turn the plain text into the required Java object, resulting in a <code class="language-plaintext highlighter-rouge">415</code>.</li>
    </ul>
  </li>
</ul>

<blockquote>
  <p><strong>In short:</strong></p>
  <ul>
    <li><strong><code class="language-plaintext highlighter-rouge">406</code></strong> is about the <strong>output format</strong> (what the server can produce).</li>
    <li><strong><code class="language-plaintext highlighter-rouge">415</code></strong> is about the <strong>input format</strong> (what the server can consume).</li>
  </ul>
</blockquote>

<p>Would you like to move on to the next topic in your study notes, or perhaps have an example of how to explicitly handle a <code class="language-plaintext highlighter-rouge">415</code> error in a Spring Boot controller?</p>

<hr />
<h2 id="-developer-insights-and-best-practices">üí° Developer Insights and Best Practices</h2>

<h3 id="key-points-developers-should-be-aware-of">Key Points Developers Should Be Aware Of</h3>

<ul>
  <li><strong>Consistency is Key:</strong>
    <ul>
      <li>While content negotiation allows for multiple formats, it‚Äôs often best practice in modern microservices to <strong>standardize on JSON</strong> unless there‚Äôs a specific requirement for XML (e.g., integration with legacy systems). JSON is lighter, faster, and universally supported by modern web tools.</li>
    </ul>
  </li>
  <li><strong>Header Priority:</strong>
    <ul>
      <li>The <strong><code class="language-plaintext highlighter-rouge">Accept</code></strong> header is the <strong>standard and preferred</strong> way. Avoid mixing URL suffixes or query parameters unless absolutely necessary, as it clutters the API design.</li>
    </ul>
  </li>
  <li><strong>Fallback Mechanism:</strong>
    <ul>
      <li>Know your server‚Äôs <strong>default type</strong>. If the client sends an <code class="language-plaintext highlighter-rouge">Accept</code> header that the server doesn‚Äôt support, the server will usually respond with the default format (typically JSON) and a <strong><code class="language-plaintext highlighter-rouge">Content-Type</code></strong> header indicating the actual format, or a <strong><code class="language-plaintext highlighter-rouge">406 Not Acceptable</code></strong> status if explicitly configured to enforce the <code class="language-plaintext highlighter-rouge">Accept</code> header.</li>
    </ul>
  </li>
  <li><strong>Version Control:</strong>
    <ul>
      <li>Content negotiation can be used for API versioning (e.g., <code class="language-plaintext highlighter-rouge">Accept: application/vnd.mycompany.v2+json</code>), though managing versions via the URL is often clearer.</li>
    </ul>
  </li>
</ul>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code></code></pre></div></div>
 <!-- Injects index.md content here -->
                </div>
            </main>
        </div>
    </div>

    <!-- External scripts -->
    <!-- bootstrap -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" defer></script>

<!-- Mermaid JS: render diagrams client-side. We convert fenced code blocks
		 with class `language-mermaid` into <div class="mermaid"> so existing
		 markdown files don't need editing. -->
<script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
<!-- Include internal JavaScript -->
 <script src="/geekmonks/assets/js/mermaid-diagram-render.js"></script>


 <!-- Submenu toggle nav on small screen-->
<script src="/geekmonks/assets/js/submenu-togle.js"></script>


</body>

</html>