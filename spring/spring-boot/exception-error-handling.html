<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet"><link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet"><link rel="stylesheet" href="/geekmonks/assets/css/styles.css"><link type="application/atom+xml" rel="alternate" href="https://srvivek1.github.io/geekmonks/feed.xml" title="Geekmonks Blog"/><title>üîÑ Exception Handling and Custom Exceptions | Geekmonks Blog</title><meta name="generator" content="Jekyll v3.10.0"/><meta property="og:title" content="üîÑ Exception Handling and Custom Exceptions"/><meta property="og:locale" content="en_US"/><meta name="description" content="üß≠ Table of Contents"/><meta property="og:description" content="üß≠ Table of Contents"/><link rel="canonical" href="https://srvivek1.github.io/geekmonks/spring/spring-boot/exception-error-handling.html"/><meta property="og:url" content="https://srvivek1.github.io/geekmonks/spring/spring-boot/exception-error-handling.html"/><meta property="og:site_name" content="Geekmonks Blog"/><meta property="og:type" content="article"/><meta property="article:published_time" content="2024-11-24T00:00:00+05:30"/><meta name="twitter:card" content="summary"/><meta property="twitter:title" content="üîÑ Exception Handling and Custom Exceptions"/><script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2024-11-24T00:00:00+05:30","datePublished":"2024-11-24T00:00:00+05:30","description":"üß≠ Table of Contents","headline":"üîÑ Exception Handling and Custom Exceptions","mainEntityOfPage":{"@type":"WebPage","@id":"https://srvivek1.github.io/geekmonks/spring/spring-boot/exception-error-handling.html"},"url":"https://srvivek1.github.io/geekmonks/spring/spring-boot/exception-error-handling.html"}</script><script async src="https://www.googletagmanager.com/gtag/js?id=G-48XEHMVSEC"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date);gtag("config","G-48XEHMVSEC");</script></head><body class="container-fluid p-0 m-0"><header><nav class="navbar navbar-expand-md navbar-light bg-light text-white content-shadow"><div class="container d-flex justify-content-between"><a href="/geekmonks/" class="navbar-brand d-flex"><img class="d-inline-block align-top" src="/geekmonks/assets/icons/laptop.svg" height="40" width="34"/><h1 class="fs-3 px-2 fw-bold">Geekmonks</h1><img class="d-inline-block align-top" src="/geekmonks/assets/icons/tux.svg" height="40" width="34"/></a><button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNavBanner" aria-controls="navbarNavBanner" aria-expanded="false" aria-label="Toggle Navigation"><span class="navbar-toggler-icon"></span></button><div id="navbarNavBanner" class="collapse navbar-collapse"><ul class="navbar-nav ms-auto"><li class="nav-item active"><a href="/geekmonks/" class="nav-link fw-bold active">Home</a></li><li class="nav-item active"><a href="/geekmonks/about" class="nav-link fw-bold active">About</a></li><li class="nav-item active"><a href="https://github.com/SRVivek1/" class="nav-link fw-bold active" target="_blank" rel="noopener noreferrer">Github</a></li><li class="nav-item active"><a href="https://www.linkedin.com/in/srvivek1/" class="nav-link fw-bold active" target="_blank" rel="noopener noreferrer">LinkedIn</a></li></ul></div></div></nav><nav class="navbar navbar-expand-xl navbar-custom p-0"><div class="container-fluid"><button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarNav"><ul class="navbar-nav mx-auto"><li class="nav-item"><a class="nav-link fw-bold text-white" href="/geekmonks/ai-ml/llm-engineering/">AI-ML</a></li><li class="nav-item"><a class="nav-link fw-bold text-white" href="/geekmonks/cloud/aws/">AWS</a></li><li class="nav-item"><a class="nav-link fw-bold text-white" href="/geekmonks/spring/spring-boot/">Spring Boot</a></li></ul></div></div></nav></header><div class="container-fluid"><div class="row min-vh-100"><nav id="course-sidebar" class="col-md-3 col-lg-2 d-md-block sidebar collapse"><div class="position-sticky pt-3"><ul class="nav flex-column course-topics-list"><a class="nav-link course-link active" href="/geekmonks/spring/spring-boot" data-course="spring/spring-boot"> Spring Boot </a><ul class="nav flex-column ms-2 subtopics" id="topics-spring-spring-boot"><li class="nav-item" style="text-align: left"><a class="nav-link topic-link small " href="getting-started.html" data-topic="getting-started.html" data-course-path="/spring/spring-boot"> Controllers - Getting Started </a></li><li class="nav-item" style="text-align: left"><a class="nav-link topic-link small " href="rest-api-validation.html" data-topic="rest-api-validation.html" data-course-path="/spring/spring-boot"> API Validation </a></li><li class="nav-item" style="text-align: left"><a class="nav-link topic-link small " href="swagger-api-doc.html" data-topic="swagger-api-doc.html" data-course-path="/spring/spring-boot"> Swagger API Documentation </a></li><li class="nav-item" style="text-align: left"><a class="nav-link topic-link small " href="content-negotiation.html" data-topic="content-negotiation.html" data-course-path="/spring/spring-boot"> Content Negotiation </a></li><li class="nav-item" style="text-align: left"><a class="nav-link topic-link small " href="i18n.html" data-topic="i18n.html" data-course-path="/spring/spring-boot"> Internationalization (i18n) </a></li><li class="nav-item" style="text-align: left"><a class="nav-link topic-link small " href="rest-api-versioning.html" data-topic="rest-api-versioning.html" data-course-path="/spring/spring-boot"> Rest API Versioning </a></li><li class="nav-item" style="text-align: left"><a class="nav-link topic-link small " href="rest-api-retirement.html" data-topic="rest-api-retirement.html" data-course-path="/spring/spring-boot"> API Retirement Strategy </a></li><li class="nav-item" style="text-align: left"><a class="nav-link topic-link small " href="hateoas.html" data-topic="hateoas.html" data-course-path="/spring/spring-boot"> HATEOAS </a></li><li class="nav-item" style="text-align: left"><a class="nav-link topic-link small " href="static-content-filtering.html" data-topic="static-content-filtering.html" data-course-path="/spring/spring-boot"> Static Content Filtering </a></li><li class="nav-item" style="text-align: left"><a class="nav-link topic-link small " href="dynamic-content-filtering.html" data-topic="dynamic-content-filtering.html" data-course-path="/spring/spring-boot"> Dynamic Content Filtering </a></li><li class="nav-item" style="text-align: left"><a class="nav-link topic-link small " href="client-driven-filtering.html" data-topic="client-driven-filtering.html" data-course-path="/spring/spring-boot"> Client-Driven Filtering </a></li><li class="nav-item" style="text-align: left"><a class="nav-link topic-link small active" href="exception-error-handling.html" data-topic="exception-error-handling.html" data-course-path="/spring/spring-boot"> Controller Error Handling </a></li><li class="nav-item" style="text-align: left"><a class="nav-link topic-link small " href="hal-explorer.html" data-topic="hal-explorer.html" data-course-path="/spring/spring-boot"> HAL Explorer </a></li><li class="nav-item" style="text-align: left"><a class="nav-link topic-link small " href="jpa-with-h2-db.html" data-topic="jpa-with-h2-db.html" data-course-path="/spring/spring-boot"> JPA with H2 DB </a></li><li class="nav-item" style="text-align: left"><a class="nav-link topic-link small " href="jpa-with-mysql-db.html" data-topic="jpa-with-mysql-db.html" data-course-path="/spring/spring-boot"> JPA with MySQL DB </a></li><li class="nav-item" style="text-align: left"><a class="nav-link topic-link small " href="jpa-jdbc-template.html" data-topic="jpa-jdbc-template.html" data-course-path="/spring/spring-boot"> JPA & JDBC Teamplate </a></li><li class="nav-item" style="text-align: left"><a class="nav-link topic-link small " href="spring-security-basics.html" data-topic="spring-security-basics.html" data-course-path="/spring/spring-boot"> Spring Security </a></li></ul></ul></div></nav><main class="col-md-9 ms-sm-auto col-lg-10 px-md-4"><button id="sidebarToggle" class="btn btn-sm btn-outline-secondary d-md-none mb-2" aria-label="Toggle topics" aria-controls="course-sidebar"> ‚ò∞ Topics </button><div id="topic-content"><div id="pageTitle"><h1>üîÑ Exception Handling and Custom Exceptions</h1><p style="font-style: italic;"> Updated on: 24 Nov 2024 - <a href="/geekmonks/authors/srvivek/">Vivek Singh</a></p><hr class="stylish-hr"/></div><h2 id="-table-of-contents">üß≠ Table of Contents</h2><ul><li><a href="#-table-of-contents">üß≠ Table of Contents</a></li><li><a href="#-introduction">üí° Introduction</a></li><li><a href="#-use-case">üéØ Use Case</a></li><li><a href="#Ô∏è-features">üõ†Ô∏è Features</a></li><li><a href="#-advantage">‚ûï Advantage</a></li><li><a href="#-drawbacks">‚ûñ Drawbacks</a></li><li><a href="#-maven-dependency">üì¶ Maven Dependency</a></li><li><a href="#-code-implementation">üìù Code Implementation</a><ul><li><a href="#1-java-bean-errordetails">1. Java Bean: ErrorDetails</a></li><li><a href="#2-custom-exception-usernotfoundexception">2. Custom Exception: <code class="language-plaintext highlighter-rouge">UserNotFoundException</code></a></li><li><a href="#3-global-exception-handler-controlleradvice">3. Global Exception Handler: <code class="language-plaintext highlighter-rouge">@ControllerAdvice</code></a></li></ul></li><li><a href="#-exception-handling-flow">üîÑ Exception Handling Flow</a></li><li><a href="#-project-poc">üîó Project POC</a></li><li><a href="#Ô∏è-key-observations">üëÅÔ∏è Key Observations</a></li><li><a href="#-best-practices-for-exception-handling">‚≠ê Best Practices for Exception Handling</a></li><li><a href="#-security-considerations">üîí Security Considerations</a></li><li><a href="#-suggested-improvements">üöÄ Suggested Improvements</a></li></ul><hr/><h2 id="-introduction">üí° Introduction</h2><p>Spring Boot provides a powerful and <strong><code class="language-plaintext highlighter-rouge">centralized mechanism</code></strong> for <strong>handling and customizing exceptions</strong> thrown by the application. This is typically achieved using the <strong><code class="language-plaintext highlighter-rouge">@ControllerAdvice</code></strong> annotation. This approach decouples error handling logic from individual controller methods, leading to cleaner and more maintainable code. The goal is to return a <strong>standardized, meaningful error response</strong> (e.g., JSON) to the client instead of a raw stack trace.</p><hr/><h2 id="-use-case">üéØ Use Case</h2><p>The primary use case is to provide a <strong>consistent and reliable API contract</strong> for error reporting. When a resource is not found (<code class="language-plaintext highlighter-rouge">404</code>), an input is invalid (<code class="language-plaintext highlighter-rouge">400</code>), or an internal server error occurs (<code class="language-plaintext highlighter-rouge">500</code>), the client should receive a predictable JSON payload containing a timestamp, a clear message, and request details. This is crucial for microservices interacting with various consumers.</p><hr/><h2 id="Ô∏è-features">üõ†Ô∏è Features</h2><ul><li><strong>Centralized Handling:</strong><ul><li>Use <strong><code class="language-plaintext highlighter-rouge">@ControllerAdvice</code></strong> to globalize exception handling across all controllers.</li></ul></li><li><strong>Exception Mapping:</strong><ul><li>Use <strong><code class="language-plaintext highlighter-rouge">@ExceptionHandler</code></strong> to map specific exception classes to handler methods.</li></ul></li><li><strong>Status Mapping:</strong><ul><li>Use <strong><code class="language-plaintext highlighter-rouge">@ResponseStatus</code></strong> on custom exceptions or set the status explicitly in the <code class="language-plaintext highlighter-rouge">ResponseEntity</code>.</li></ul></li><li><strong>Standardized Payload:</strong><ul><li>Define a custom <code class="language-plaintext highlighter-rouge">ErrorDetails</code> bean to ensure a consistent structure for error responses.</li></ul></li><li><strong>Separation of Concerns:</strong><ul><li>Keeps business logic and error handling distinctly separated.</li></ul></li></ul><hr/><h2 id="-advantage">‚ûï Advantage</h2><p>Centralized exception handling significantly improves <strong>API consistency</strong> and <strong>developer experience (DX)</strong>.</p><ul><li>It eliminates redundant <code class="language-plaintext highlighter-rouge">try-catch</code> blocks in controllers, <code class="language-plaintext highlighter-rouge">reduces boilerplate code</code>, and ensures that clients always receive well-structured error messages, simplifying debugging and integration.</li><li>The use of <code class="language-plaintext highlighter-rouge">custom exceptions</code> clearly defines application-specific errors.</li></ul><hr/><h2 id="-drawbacks">‚ûñ Drawbacks</h2><p>While beneficial, the setup involves initial overhead by requiring the creation of custom exception classes and the global handler.</p><ul><li>Over-reliance on too many highly specific custom exceptions can lead to <strong><code class="language-plaintext highlighter-rouge">exception proliferation</code></strong>, making the code harder to navigate.</li><li>Moreover, incorrectly configuring the handler can unintentionally expose sensitive internal details.</li></ul><hr/><h2 id="-maven-dependency">üì¶ Maven Dependency</h2><p>The core functionalities for web applications, including exception handling via <code class="language-plaintext highlighter-rouge">@ControllerAdvice</code> and support for <code class="language-plaintext highlighter-rouge">ResponseEntity</code>, are provided by the <code class="language-plaintext highlighter-rouge">spring-boot-starter-web</code> dependency.</p><div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;dependency&gt;</span>
    <span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>spring-boot-starter-web<span class="nt">&lt;/artifactId&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
</code></pre></div></div><hr/><h2 id="-code-implementation">üìù Code Implementation</h2><p><br/></p><h3 id="1-java-bean-errordetails">1. Java Bean: ErrorDetails</h3><p>This class defines the <strong>standard structure</strong> for the error response payload sent back to the client. It typically includes temporal and context information.</p><p><strong><code class="language-plaintext highlighter-rouge">ErrorDetails.java</code></strong></p><div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">java.time.LocalDateTime</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ErrorDetails</span> <span class="o">{</span>

    <span class="kd">private</span> <span class="nc">LocalDateTime</span> <span class="n">timestamp</span><span class="o">;</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">message</span><span class="o">;</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">details</span><span class="o">;</span>

    <span class="c1">// Default Constructor</span>
    <span class="kd">public</span> <span class="nf">ErrorDetails</span><span class="o">()</span> <span class="o">{</span>
    <span class="o">}</span>

    <span class="c1">// Parametrized Constructor</span>
    <span class="kd">public</span> <span class="nf">ErrorDetails</span><span class="o">(</span><span class="nc">LocalDateTime</span> <span class="n">timestamp</span><span class="o">,</span> <span class="nc">String</span> <span class="n">message</span><span class="o">,</span> <span class="nc">String</span> <span class="n">details</span><span class="o">)</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">();</span>
        <span class="k">this</span><span class="o">.</span><span class="na">timestamp</span> <span class="o">=</span> <span class="n">timestamp</span><span class="o">;</span>
        <span class="k">this</span><span class="o">.</span><span class="na">message</span> <span class="o">=</span> <span class="n">message</span><span class="o">;</span>
        <span class="k">this</span><span class="o">.</span><span class="na">details</span> <span class="o">=</span> <span class="n">details</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="c1">// Constructor, setter-getters... (Assuming these are implemented for brevity)</span>
    <span class="c1">// Getter and Setter methods for timestamp, message, and details should be present.</span>
    <span class="c1">// Example Getter:</span>
    <span class="kd">public</span> <span class="nc">LocalDateTime</span> <span class="nf">getTimestamp</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">timestamp</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="c1">// Example Setter:</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setTimestamp</span><span class="o">(</span><span class="nc">LocalDateTime</span> <span class="n">timestamp</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">timestamp</span> <span class="o">=</span> <span class="n">timestamp</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div><p><br/></p><h3 id="2-custom-exception-usernotfoundexception">2. Custom Exception: <code class="language-plaintext highlighter-rouge">UserNotFoundException</code></h3><p>A custom exception class is used to clearly signal an application-specific error. The <strong><code class="language-plaintext highlighter-rouge">@ResponseStatus(code = HttpStatus.NOT_FOUND)</code></strong> annotation is a convenient way to automatically map this exception to a specific HTTP status code, even without a <code class="language-plaintext highlighter-rouge">@ControllerAdvice</code>.</p><p><strong><code class="language-plaintext highlighter-rouge">UserNotFoundException.java</code></strong></p><div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">org.springframework.http.HttpStatus</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.ResponseStatus</span><span class="o">;</span>

<span class="nd">@ResponseStatus</span><span class="o">(</span><span class="n">code</span> <span class="o">=</span> <span class="nc">HttpStatus</span><span class="o">.</span><span class="na">NOT_FOUND</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">UserNotFoundException</span> <span class="kd">extends</span> <span class="nc">RuntimeException</span> <span class="o">{</span>

    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">long</span> <span class="n">serialVersionUID</span> <span class="o">=</span> <span class="mi">4882099180124262207L</span><span class="o">;</span>

    <span class="kd">public</span> <span class="nf">UserNotFoundException</span><span class="o">(</span><span class="nc">String</span> <span class="n">message</span><span class="o">)</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">(</span><span class="n">message</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div><p><br/></p><h3 id="3-global-exception-handler-controlleradvice">3. Global Exception Handler: <code class="language-plaintext highlighter-rouge">@ControllerAdvice</code></h3><p>The <strong><code class="language-plaintext highlighter-rouge">@ControllerAdvice</code></strong> (or <code class="language-plaintext highlighter-rouge">@RestControllerAdvice</code>) is the central component. It uses <strong><code class="language-plaintext highlighter-rouge">@ExceptionHandler</code></strong> methods to intercept and process exceptions across the entire application, allowing us to return a standardized <code class="language-plaintext highlighter-rouge">ResponseEntity&lt;ErrorDetails&gt;</code>.</p><p><strong><code class="language-plaintext highlighter-rouge">CustomizedResponseEntityExceptionHandler.java</code></strong></p><div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">java.time.LocalDateTime</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.slf4j.Logger</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.slf4j.LoggerFactory</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.http.HttpStatus</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.http.ResponseEntity</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.ControllerAdvice</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.ExceptionHandler</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.context.request.WebRequest</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.servlet.mvc.method.annotation.ResponseEntityExceptionHandler</span><span class="o">;</span>

<span class="nd">@ControllerAdvice</span>
<span class="c1">//@ControllerAdvice(basePackages = "com.srvivek.x.y.z") //for specific package</span>
<span class="c1">//@Order(value = 1) // for defining ordering</span>
<span class="c1">//@Priority(value = 1) // for defining ordering</span>
<span class="c1">//@RestControllerAdvice(basePackages = "com.srvivek.x.y.z") // @ControllerAdvice + @ResponseBody</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">CustomizedResponseEntityExceptionHandler</span> <span class="kd">extends</span> <span class="nc">ResponseEntityExceptionHandler</span> <span class="o">{</span>

    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="nc">Logger</span> <span class="n">logger</span> <span class="o">=</span> <span class="nc">LoggerFactory</span><span class="o">.</span><span class="na">getLogger</span><span class="o">(</span><span class="nc">CustomizedResponseEntityExceptionHandler</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>

    <span class="cm">/**
    * Generic exception handling (Fallback for all unhandled exceptions).
    * Returns HTTP 500 INTERNAL_SERVER_ERROR.
    * @param ex
    * @param request
    * @return
    * @throws Exception
    */</span>
    <span class="nd">@ExceptionHandler</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="nc">Exception</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
    <span class="kd">public</span> <span class="kd">final</span> <span class="nc">ResponseEntity</span><span class="o">&lt;</span><span class="nc">ErrorDetails</span><span class="o">&gt;</span> <span class="nf">handleAllException</span><span class="o">(</span><span class="nc">Exception</span> <span class="n">ex</span><span class="o">,</span> <span class="nc">WebRequest</span> <span class="n">request</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>

        <span class="n">logger</span><span class="o">.</span><span class="na">error</span><span class="o">(</span><span class="s">"Error stacktrace: {}"</span><span class="o">,</span> <span class="n">ex</span><span class="o">);</span>

        <span class="nc">ErrorDetails</span> <span class="n">errorDetails</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ErrorDetails</span><span class="o">(</span><span class="nc">LocalDateTime</span><span class="o">.</span><span class="na">now</span><span class="o">(),</span> <span class="n">ex</span><span class="o">.</span><span class="na">getMessage</span><span class="o">(),</span>
                <span class="n">request</span><span class="o">.</span><span class="na">getDescription</span><span class="o">(</span><span class="kc">false</span><span class="o">));</span>

        <span class="k">return</span> <span class="k">new</span> <span class="nc">ResponseEntity</span><span class="o">&lt;</span><span class="nc">ErrorDetails</span><span class="o">&gt;(</span><span class="n">errorDetails</span><span class="o">,</span> <span class="nc">HttpStatus</span><span class="o">.</span><span class="na">INTERNAL_SERVER_ERROR</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="cm">/**
    * Specific exception handling for UserNotFoundException.
    * Returns HTTP 404 NOT_FOUND.
    * @param ex
    * @param request
    * @return
    * @throws Exception
    */</span>
    <span class="nd">@ExceptionHandler</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="nc">UserNotFoundException</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
    <span class="kd">public</span> <span class="kd">final</span> <span class="nc">ResponseEntity</span><span class="o">&lt;</span><span class="nc">ErrorDetails</span><span class="o">&gt;</span> <span class="nf">handleUserNotFoundException</span><span class="o">(</span><span class="nc">Exception</span> <span class="n">ex</span><span class="o">,</span> <span class="nc">WebRequest</span> <span class="n">request</span><span class="o">)</span>
            <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>

        <span class="n">logger</span><span class="o">.</span><span class="na">error</span><span class="o">(</span><span class="s">"Error stacktrace: {}"</span><span class="o">,</span> <span class="n">ex</span><span class="o">);</span>

        <span class="nc">ErrorDetails</span> <span class="n">errorDetails</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ErrorDetails</span><span class="o">(</span><span class="nc">LocalDateTime</span><span class="o">.</span><span class="na">now</span><span class="o">(),</span> <span class="n">ex</span><span class="o">.</span><span class="na">getMessage</span><span class="o">(),</span>
                <span class="n">request</span><span class="o">.</span><span class="na">getDescription</span><span class="o">(</span><span class="kc">false</span><span class="o">));</span>

        <span class="k">return</span> <span class="k">new</span> <span class="nc">ResponseEntity</span><span class="o">&lt;</span><span class="nc">ErrorDetails</span><span class="o">&gt;(</span><span class="n">errorDetails</span><span class="o">,</span> <span class="nc">HttpStatus</span><span class="o">.</span><span class="na">NOT_FOUND</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div><hr/><h2 id="-exception-handling-flow">üîÑ Exception Handling Flow</h2><p>The diagram illustrates how an exception is captured and processed by the global handler before a standardized response is returned to the client.</p><pre><code class="language-mermaid">sequenceDiagram
    participant C as Client
    participant A as Controller
    participant S as Service
    participant E as Exception
    participant H as @ControllerAdvice
    participant L as Logger
    C-&gt;&gt;A: API Request (e.g., GET /users/100)
    A-&gt;&gt;S: Call Service Method (findUser(100))
    alt User Not Found
        S--&gt;E: Throws UserNotFoundException
        E-&gt;&gt;H: Exception Interception
        H-&gt;&gt;L: Log Error Stacktrace
        H--&gt;&gt;C: Standardized Error Response (404 NOT FOUND)
    else User Found
        S--&gt;&gt;A: User Object
        A--&gt;&gt;C: HTTP 200 OK Response
    end
</code></pre><hr/><p><br/></p><h2 id="-project-poc">üîó Project POC</h2><p>The implementation discussed above is demonstrated in the following sample project:</p><p><strong>Project reference:</strong><a href="https://github.com/SRVivek1/springboot-microservices-2024/tree/main/a2-sboot-ms-social-media-app/">Exception Handing POC</a></p><hr/><h2 id="Ô∏è-key-observations">üëÅÔ∏è Key Observations</h2><table><thead><tr><th style="text-align: left">Feature</th><th style="text-align: left">Description</th><th style="text-align: left">Example / Annotation</th></tr></thead><tbody><tr><td style="text-align: left"><strong>Scoping</strong></td><td style="text-align: left">Allows the exception handler to apply only to <strong>controllers within specific packages</strong>, providing modularity.</td><td style="text-align: left"><code class="language-plaintext highlighter-rouge">@ControllerAdvice(basePackages = "com.srvivek.x.y.z")</code></td></tr><tr><td style="text-align: left"><strong>Ordering</strong></td><td style="text-align: left">Defines the <strong>precedence</strong> when multiple <code class="language-plaintext highlighter-rouge">@ControllerAdvice</code> classes exist, ensuring predictable exception resolution.</td><td style="text-align: left"><code class="language-plaintext highlighter-rouge">@Order(value = 1)</code> or <code class="language-plaintext highlighter-rouge">@Priority(value = 1)</code></td></tr><tr><td style="text-align: left"><strong>Logging</strong></td><td style="text-align: left">It is <strong>critical</strong> to explicitly log the exception within the handler, as Spring Boot doesn‚Äôt automatically log the intercepted exception‚Äôs details.</td><td style="text-align: left"><code class="language-plaintext highlighter-rouge">logger.error("Error stacktrace: {}", ex);</code></td></tr><tr><td style="text-align: left"><strong>Convenience</strong></td><td style="text-align: left">A specialized annotation that is equivalent to combining <strong><code class="language-plaintext highlighter-rouge">@ControllerAdvice</code></strong> and <strong><code class="language-plaintext highlighter-rouge">@ResponseBody</code></strong>, streamlining REST API development.</td><td style="text-align: left"><code class="language-plaintext highlighter-rouge">@RestControllerAdvice</code></td></tr></tbody></table><hr/><h2 id="-best-practices-for-exception-handling">‚≠ê Best Practices for Exception Handling</h2><table><thead><tr><th style="text-align: left">Practice</th><th style="text-align: left">Description</th><th style="text-align: left">Key Action / Benefit</th></tr></thead><tbody><tr><td style="text-align: left"><strong>Log Explicitly</strong></td><td style="text-align: left">Always ensure the full exception stack trace is captured and recorded on the server side.</td><td style="text-align: left">Use <code class="language-plaintext highlighter-rouge">logger.error(ex.getMessage(), ex);</code> in the handler method.</td></tr><tr><td style="text-align: left"><strong>Specific to Generic</strong></td><td style="text-align: left">Structure your <code class="language-plaintext highlighter-rouge">@ExceptionHandler</code> methods to catch the most specific exceptions first, with a fallback to the generic <code class="language-plaintext highlighter-rouge">Exception.class</code>.</td><td style="text-align: left">Ensures the correct HTTP status and custom message is returned for known errors.</td></tr><tr><td style="text-align: left"><strong>Avoid Exposing Details</strong></td><td style="text-align: left">Never include sensitive server-side information (like stack traces or internal paths) in the API error response sent to the client.</td><td style="text-align: left">Sanitize the error message and use a simple <code class="language-plaintext highlighter-rouge">details</code> field.</td></tr><tr><td style="text-align: left"><strong>Leverage Spring‚Äôs Built-in</strong></td><td style="text-align: left">Extend <code class="language-plaintext highlighter-rouge">ResponseEntityExceptionHandler</code> to customize handling of common Spring exceptions (e.g., validation failures, method not allowed).</td><td style="text-align: left">Provides easy overrides for exceptions like <code class="language-plaintext highlighter-rouge">MethodArgumentNotValidException</code>.</td></tr><tr><td style="text-align: left"><strong>Use Problem Detail Standard</strong></td><td style="text-align: left">Adopt the <strong>RFC 7807</strong> standard (<code class="language-plaintext highlighter-rouge">type</code>, <code class="language-plaintext highlighter-rouge">title</code>, <code class="language-plaintext highlighter-rouge">status</code>, <code class="language-plaintext highlighter-rouge">detail</code>, <code class="language-plaintext highlighter-rouge">instance</code>) for your error response structure.</td><td style="text-align: left">Enhances API maturity, consistency, and client-side error processing.</td></tr></tbody></table><hr/><h2 id="-security-considerations">üîí Security Considerations</h2><ul><li><strong>No Stack Traces in Response:</strong> Ensure the client-facing error message <strong>never</strong> contains server-side stack traces, internal configuration, or sensitive class names.</li><li><strong>Generic Messages for 5xx:</strong> For <code class="language-plaintext highlighter-rouge">500 INTERNAL_SERVER_ERROR</code> or other unexpected errors, provide a generic message like ‚ÄúAn unexpected error occurred‚Äù and use a unique <strong>correlation ID</strong> (logged server-side) that the client can reference when reporting the issue.</li><li><strong>Input Validation:</strong> Implement proper input validation <em>before</em> the exception handler to prevent common injection attacks or unexpected behaviour.</li></ul><hr/><h2 id="-suggested-improvements">üöÄ Suggested Improvements</h2><p>The current implementation is solid for basic REST error handling. A key improvement would be:</p><ul><li><strong>Validation Handling:</strong> Add a dedicated <code class="language-plaintext highlighter-rouge">@ExceptionHandler</code> for <strong><code class="language-plaintext highlighter-rouge">MethodArgumentNotValidException</code></strong> (thrown when <code class="language-plaintext highlighter-rouge">@Valid</code> fails). This allows for a structured response listing all field validation errors, which is crucial for REST APIs. You can achieve this by overriding the relevant method from <code class="language-plaintext highlighter-rouge">ResponseEntityExceptionHandler</code>.</li></ul><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code></code></pre></div></div></div></main></div></div><script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script><script src="/geekmonks/assets/js/mermaid-diagram-render.js"></script><script src="/geekmonks/assets/js/submenu-togle.js"></script></body></html>