<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta http-equiv="refresh" content="10; url=https://geekmonks.com/"><meta name="keywords" content="geekmonks, geek, tech, geekmonks tech, free tutorial, free online tutorial"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"><meta name="apple-mobile-web-app-title" content="Geekmonks Tech"><meta name="mobile-web-app-capable" content="yes"><link rel="icon" type="image/png" href="/geekmonks/assets/favicon/favicon-96x96.png" sizes="96x96"/><link rel="icon" type="image/svg+xml" href="/geekmonks/assets/favicon/favicon.svg"/><link rel="shortcut icon" href="/geekmonks/assets/favicon/favicon.ico"/><link rel="apple-touch-icon" sizes="180x180" href="/geekmonks/assets/favicon/apple-touch-icon.png"/><link rel="manifest" href="/geekmonks/assets/favicon/site.webmanifest"/><link type="application/atom+xml" rel="alternate" href="https://srvivek1.github.io/geekmonks/feed.xml" title="Geekmonks Tech"/><title>üìö JPA with H2 Database | Geekmonks Tech</title><meta name="generator" content="Jekyll v3.10.0"/><meta property="og:title" content="üìö JPA with H2 Database"/><meta property="og:locale" content="en_US"/><meta name="description" content="Geekmonks Tech - Spring Tutorial, Spring Boot Tutorial, Free Spring Boot tutorial, Free Online Tutorials, geekmonks provides tutorials and interview questions for Spring Boot, Spring, controllers, rest controllers, api, Spring data, JPA, hibernate, database, connection pool, transcation query, H2 Database, in memory database etc. for beginners and professionals."/><meta property="og:description" content="Geekmonks Tech - Spring Tutorial, Spring Boot Tutorial, Free Spring Boot tutorial, Free Online Tutorials, geekmonks provides tutorials and interview questions for Spring Boot, Spring, controllers, rest controllers, api, Spring data, JPA, hibernate, database, connection pool, transcation query, H2 Database, in memory database etc. for beginners and professionals."/><link rel="canonical" href="https://srvivek1.github.io/geekmonks/spring/spring-boot/jpa-with-h2-db.html"/><meta property="og:url" content="https://srvivek1.github.io/geekmonks/spring/spring-boot/jpa-with-h2-db.html"/><meta property="og:site_name" content="Geekmonks Tech"/><meta property="og:type" content="article"/><meta property="article:published_time" content="2024-12-04T15:00:00+05:30"/><meta name="twitter:card" content="summary"/><meta property="twitter:title" content="üìö JPA with H2 Database"/><meta name="twitter:site" content="@srvivek_"/><script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2024-12-04T15:00:00+05:30","datePublished":"2024-12-04T15:00:00+05:30","description":"Geekmonks Tech - Spring Tutorial, Spring Boot Tutorial, Free Spring Boot tutorial, Free Online Tutorials, geekmonks provides tutorials and interview questions for Spring Boot, Spring, controllers, rest controllers, api, Spring data, JPA, hibernate, database, connection pool, transcation query, H2 Database, in memory database etc. for beginners and professionals.","headline":"üìö JPA with H2 Database","mainEntityOfPage":{"@type":"WebPage","@id":"https://srvivek1.github.io/geekmonks/spring/spring-boot/jpa-with-h2-db.html"},"url":"https://srvivek1.github.io/geekmonks/spring/spring-boot/jpa-with-h2-db.html"}</script><script async src="https://www.googletagmanager.com/gtag/js?id=G-48XEHMVSEC"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date);gtag("config","G-48XEHMVSEC");</script><link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet"><link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet"><link rel="stylesheet" href="/geekmonks/assets/css/styles.css?v=0.1.0"></head><body class="container-fluid p-0 m-0"><p class="newPortalRedirect">You will be redirect to our new portal, Happy Learning. If you are not redirected automatically, please click <a href="https://geekmonks.com/">here</a>.</p><header><nav class="navbar navbar-expand-md navbar-light bg-light text-white content-shadow"><div class="container d-flex justify-content-between"><a href="/geekmonks/" class="navbar-brand d-flex"><img class="d-inline-block align-top" src="/geekmonks/assets/icons/laptop.svg" height="40" width="34" alt="banner-1 laptop icon"/><h1 class="fs-3 px-2 fw-bold">Geekmonks</h1><img class="d-inline-block align-top" src="/geekmonks/assets/icons/tux.svg" height="40" width="34" alt="banner-2 penguine icon"/></a><button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNavBanner" aria-controls="navbarNavBanner" aria-expanded="false" aria-label="Toggle Navigation"><span class="navbar-toggler-icon"></span></button><div id="navbarNavBanner" class="collapse navbar-collapse"><ul class="navbar-nav ms-auto"><li class="nav-item active"><a href="/geekmonks/" class="nav-link fw-bold active">Home</a></li><li class="nav-item active"><a href="/geekmonks/about" class="nav-link fw-bold active">About</a></li><li class="nav-item active"><a href="https://github.com/SRVivek1/" class="nav-link fw-bold active" target="_blank" rel="noopener noreferrer">Github</a></li><li class="nav-item active"><a href="https://www.linkedin.com/in/srvivek1/" class="nav-link fw-bold active" target="_blank" rel="noopener noreferrer">LinkedIn</a></li></ul></div></div></nav><nav class="navbar navbar-expand-xl navbar-custom p-0"><div class="container-fluid"><button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarNav"><ul class="navbar-nav mx-auto"><li class="nav-item"><a class="nav-link fw-bold text-white" href="/geekmonks/ai-ml/llm-engineering/">AI-ML</a></li><li class="nav-item"><a class="nav-link fw-bold text-white" href="/geekmonks/cloud/aws/">AWS</a></li><li class="nav-item"><a class="nav-link fw-bold text-white" href="/geekmonks/spring/spring-boot/">Spring Boot</a></li></ul></div></div></nav></header><div class="container-fluid"><div class="row min-vh-100"><nav id="course-sidebar" class="col-md-3 col-lg-2 d-md-block sidebar collapse"><div class="position-sticky pt-3"><ul class="nav flex-column course-topics-list"><a class="nav-link course-link active" href="/geekmonks/spring/spring-boot" data-course="spring/spring-boot"> Spring Boot </a><ul class="nav flex-column ms-2 subtopics" id="topics-spring-spring-boot"><li class="nav-item" style="text-align: left"><a class="nav-link topic-link small " href="getting-started.html" data-topic="getting-started.html" data-course-path="/spring/spring-boot"> Getting Started </a></li><li class="nav-item" style="text-align: left"><a class="nav-link topic-link small " href="rest-api-validation.html" data-topic="rest-api-validation.html" data-course-path="/spring/spring-boot"> API Validation </a></li><li class="nav-item" style="text-align: left"><a class="nav-link topic-link small " href="swagger-api-doc.html" data-topic="swagger-api-doc.html" data-course-path="/spring/spring-boot"> API Documentation </a></li><li class="nav-item" style="text-align: left"><a class="nav-link topic-link small " href="content-negotiation.html" data-topic="content-negotiation.html" data-course-path="/spring/spring-boot"> Content Negotiation </a></li><li class="nav-item" style="text-align: left"><a class="nav-link topic-link small " href="i18n.html" data-topic="i18n.html" data-course-path="/spring/spring-boot"> Internationalization (i18n) </a></li><li class="nav-item" style="text-align: left"><a class="nav-link topic-link small " href="rest-api-versioning.html" data-topic="rest-api-versioning.html" data-course-path="/spring/spring-boot"> API Versioning </a></li><li class="nav-item" style="text-align: left"><a class="nav-link topic-link small " href="rest-api-retirement.html" data-topic="rest-api-retirement.html" data-course-path="/spring/spring-boot"> API Retirement Strategy </a></li><li class="nav-item" style="text-align: left"><a class="nav-link topic-link small " href="hateoas.html" data-topic="hateoas.html" data-course-path="/spring/spring-boot"> HATEOAS </a></li><li class="nav-item" style="text-align: left"><a class="nav-link topic-link small " href="static-content-filtering.html" data-topic="static-content-filtering.html" data-course-path="/spring/spring-boot"> Static Content Filtering </a></li><li class="nav-item" style="text-align: left"><a class="nav-link topic-link small " href="dynamic-content-filtering.html" data-topic="dynamic-content-filtering.html" data-course-path="/spring/spring-boot"> Dynamic Content Filtering </a></li><li class="nav-item" style="text-align: left"><a class="nav-link topic-link small " href="client-driven-filtering.html" data-topic="client-driven-filtering.html" data-course-path="/spring/spring-boot"> Client-Driven Filtering </a></li><li class="nav-item" style="text-align: left"><a class="nav-link topic-link small " href="exception-error-handling.html" data-topic="exception-error-handling.html" data-course-path="/spring/spring-boot"> Controller Error Handling </a></li><li class="nav-item" style="text-align: left"><a class="nav-link topic-link small " href="hal-explorer.html" data-topic="hal-explorer.html" data-course-path="/spring/spring-boot"> HAL Explorer </a></li><li class="nav-item" style="text-align: left"><a class="nav-link topic-link small " href="spring-data-jpa.html" data-topic="spring-data-jpa.html" data-course-path="/spring/spring-boot"> Spring Data JPA </a></li><li class="nav-item" style="text-align: left"><a class="nav-link topic-link small active" href="jpa-with-h2-db.html" data-topic="jpa-with-h2-db.html" data-course-path="/spring/spring-boot"> JPA with H2 DB </a></li><li class="nav-item" style="text-align: left"><a class="nav-link topic-link small " href="jpa-with-mysql-db.html" data-topic="jpa-with-mysql-db.html" data-course-path="/spring/spring-boot"> JPA with MySQL DB </a></li><li class="nav-item" style="text-align: left"><a class="nav-link topic-link small " href="jpa-jdbc-template.html" data-topic="jpa-jdbc-template.html" data-course-path="/spring/spring-boot"> JPA & JDBC Teamplate </a></li><li class="nav-item" style="text-align: left"><a class="nav-link topic-link small " href="spring-security-basics.html" data-topic="spring-security-basics.html" data-course-path="/spring/spring-boot"> Spring Security </a></li></ul></ul></div></nav><main class="col-md-9 ms-sm-auto col-lg-10 px-md-4"><button id="sidebarToggle" class="btn btn-sm btn-outline-secondary d-md-none mb-2" aria-label="Toggle topics" aria-controls="course-sidebar"> ‚ò∞ Topics </button><div id="topic-content"><div id="pageTitle"><h1>üìö JPA with H2 Database</h1><h2 style="font-size: medium;">üëâ Integrate H2 Databases using JPA.</h2><p style="font-style: italic;"> Updated on: 04 Dec 2024 - <a href="/geekmonks/authors/srvivek/">Vivek Singh</a></p><hr class="stylish-hr"/></div><h2 id="table-of-contents">Table of Contents</h2><ul><li><a href="#table-of-contents">Table of Contents</a></li><li><a href="#-introduction">üöÄ Introduction</a></li><li><a href="#Ô∏è-project-implementation">‚öôÔ∏è Project Implementation</a><ul><li><a href="#h2-configuration">H2 Configuration</a></li><li><a href="#entity-class">Entity Class</a></li><li><a href="#repository-class">Repository Class</a></li></ul></li><li><a href="#-paging-and-sorting">üìÑ Paging and Sorting</a><ul><li><a href="#code-implementation-example">Code Implementation Example</a><ul><li><a href="#repository-productrepository">Repository (<code class="language-plaintext highlighter-rouge">ProductRepository</code>)</a></li><li><a href="#service-implementation-productserviceimpl">Service Implementation (<code class="language-plaintext highlighter-rouge">ProductServiceImpl</code>)</a></li><li><a href="#controller-productcontroller">Controller (<code class="language-plaintext highlighter-rouge">ProductController</code>)</a></li></ul></li></ul></li><li><a href="#-custom-queries-jpqlsql-implementation">üîç Custom Queries (JPQL/SQL) Implementation</a><ul><li><a href="#-code-implementation">üìù Code Implementation</a><ul><li><a href="#repository-productrepository-1">Repository (<code class="language-plaintext highlighter-rouge">ProductRepository</code>)</a></li><li><a href="#service-implementation-productserviceimpl-1">Service Implementation (<code class="language-plaintext highlighter-rouge">ProductServiceImpl</code>)</a></li></ul></li></ul></li><li><a href="#-optimistic-locking-version-control">üîí Optimistic Locking (Version Control)</a><ul><li><a href="#-code-implementation-1">üìù Code Implementation</a><ul><li><a href="#entity-class-product">Entity Class (<code class="language-plaintext highlighter-rouge">Product</code>)</a></li><li><a href="#service-implementation-productserviceimpl-2">Service Implementation (<code class="language-plaintext highlighter-rouge">ProductServiceImpl</code>)</a></li></ul></li></ul></li><li><a href="#-observability">üìà Observability</a></li><li><a href="#-key-awareness-points-for-experienced-engineers">üß† Key Awareness Points for Experienced Engineers</a></li></ul><hr/><p><br/></p><h2 id="-introduction">üöÄ Introduction</h2><p>Connecting to a database is fundamental to any enterprise application, and <strong>Spring Data JPA</strong> simplifies this immensely.</p><ul><li>For rapid development and testing, the <strong><code class="language-plaintext highlighter-rouge">H2 in-memory database</code></strong> is the ideal choice, offering a lightweight and quick setup.</li><li>Let‚Äôs dive in to understand required configuration in Spring Boot to leverage JPA for seamless data access. Explore setting up the connection details and enabling the necessary components to get a fully functional data layer integrated with H2.</li></ul><hr/><p><br/></p><h2 id="Ô∏è-project-implementation">‚öôÔ∏è Project Implementation</h2><ul><li><strong>Github: Project Reference:</strong><a href="https://github.com/SRVivek1/springboot-microservices-2024/tree/develop/a12-sboot-ms-h2-jpa"><code class="language-plaintext highlighter-rouge">Spring Data JPA and H2 Database</code></a>.</li></ul><h3 id="h2-configuration">H2 Configuration</h3><p>The <strong><code class="language-plaintext highlighter-rouge">application.properties</code></strong> file configures the in-memory H2 database.</p><div class="language-properties highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># application.properties
</span><span class="py">spring.h2.console.enabled</span><span class="p">=</span><span class="s">true</span>
<span class="py">spring.h2.console.path</span><span class="p">=</span><span class="s">/h2-console</span>
<span class="py">spring.datasource.url</span><span class="p">=</span><span class="s">jdbc:h2:mem:testdb</span>
<span class="py">spring.datasource.driverClassName</span><span class="p">=</span><span class="s">org.h2.Driver</span>
<span class="py">spring.datasource.username</span><span class="p">=</span><span class="s">sa</span>
<span class="py">spring.datasource.password</span><span class="p">=</span><span class="s">password</span>
<span class="py">spring.jpa.database-platform</span><span class="p">=</span><span class="s">org.hibernate.dialect.H2Dialect</span>
<span class="py">spring.jpa.hibernate.ddl-auto</span><span class="p">=</span><span class="s">update</span>
<span class="py">logging.level.org.hibernate.SQL</span><span class="p">=</span><span class="s">debug</span>
</code></pre></div></div><p><br/></p><h3 id="entity-class">Entity Class</h3><p>The <code class="language-plaintext highlighter-rouge">Product</code> class is the JPA Entity, representing a table in the database.</p><div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// src/main/java/com/geekmonks/entity/Product.java</span>
<span class="kn">package</span> <span class="nn">com.geekmonks.entity</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">jakarta.persistence.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.time.LocalDateTime</span><span class="o">;</span>

<span class="nd">@Entity</span>
<span class="nd">@Table</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"product"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Product</span> <span class="o">{</span>

    <span class="nd">@Id</span>
    <span class="nd">@GeneratedValue</span><span class="o">(</span><span class="n">strategy</span> <span class="o">=</span> <span class="nc">GenerationType</span><span class="o">.</span><span class="na">IDENTITY</span><span class="o">)</span>
    <span class="kd">private</span> <span class="nc">Long</span> <span class="n">productId</span><span class="o">;</span>

    <span class="kd">private</span> <span class="nc">String</span> <span class="n">productName</span><span class="o">;</span>
    <span class="kd">private</span> <span class="nc">Double</span> <span class="n">price</span><span class="o">;</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">category</span><span class="o">;</span>

    <span class="c1">// Standard constructor, getters, and setters...</span>
    <span class="c1">// Removed for brevity but essential in the actual class.</span>
    
    <span class="c1">// Minimal constructor for example</span>
    <span class="kd">public</span> <span class="nf">Product</span><span class="o">()</span> <span class="o">{}</span>
    <span class="kd">public</span> <span class="nf">Product</span><span class="o">(</span><span class="nc">String</span> <span class="n">productName</span><span class="o">,</span> <span class="nc">Double</span> <span class="n">price</span><span class="o">,</span> <span class="nc">String</span> <span class="n">category</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">productName</span> <span class="o">=</span> <span class="n">productName</span><span class="o">;</span>
        <span class="k">this</span><span class="o">.</span><span class="na">price</span> <span class="o">=</span> <span class="n">price</span><span class="o">;</span>
        <span class="k">this</span><span class="o">.</span><span class="na">category</span> <span class="o">=</span> <span class="n">category</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div><p><br/></p><h3 id="repository-class">Repository Class</h3><p>The repository interface extends <code class="language-plaintext highlighter-rouge">JpaRepository</code> to leverage automatic CRUD functionality.</p><div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// src/main/java/com/geekmonks/repository/ProductRepository.java</span>
<span class="kn">package</span> <span class="nn">com.geekmonks.repository</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.geekmonks.entity.Product</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.data.jpa.repository.JpaRepository</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Repository</span><span class="o">;</span>

<span class="nd">@Repository</span>
<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">ProductRepository</span> <span class="kd">extends</span> <span class="nc">JpaRepository</span><span class="o">&lt;</span><span class="nc">Product</span><span class="o">,</span> <span class="nc">Long</span><span class="o">&gt;</span> <span class="o">{</span>

    <span class="c1">// Custom query derivation methods can be added here</span>
    <span class="nc">Product</span> <span class="nf">findByProductName</span><span class="o">(</span><span class="nc">String</span> <span class="n">productName</span><span class="o">);</span>
<span class="o">}</span>
</code></pre></div></div><hr/><p><br/></p><h2 id="-paging-and-sorting">üìÑ Paging and Sorting</h2><p><strong>Paging and Sorting</strong> are essential for handling large datasets efficiently by retrieving a small, manageable chunk of data at a time. The approach uses the <strong><code class="language-plaintext highlighter-rouge">PagingAndSortingRepository</code></strong> or, more commonly, the <strong><code class="language-plaintext highlighter-rouge">JpaRepository</code></strong> (which extends it) and utilizes the <strong><code class="language-plaintext highlighter-rouge">Pageable</code></strong> interface in the repository method signature.</p><ul><li><strong>Use Case:</strong> Displaying a list of products in an e-commerce catalog or showing search results where the total number of records is very large.</li><li><strong>Benefits:</strong><strong>Improved application performance</strong>, reduced database load, and a better <strong>User Experience (UX)</strong> as users only load visible data.</li></ul><p><br/></p><h3 id="code-implementation-example">Code Implementation Example</h3><p>This involves <strong>modifications</strong> in the <code class="language-plaintext highlighter-rouge">Controller, Service, and Repository</code> classes.</p><p><br/></p><h4 id="repository-productrepository">Repository (<code class="language-plaintext highlighter-rouge">ProductRepository</code>)</h4><ul><li>No change is required as <code class="language-plaintext highlighter-rouge">JpaRepository</code> already provides methods that accept <code class="language-plaintext highlighter-rouge">Pageable</code>.</li></ul><p><br/></p><h4 id="service-implementation-productserviceimpl">Service Implementation (<code class="language-plaintext highlighter-rouge">ProductServiceImpl</code>)</h4><div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// src/main/java/com/geekmonks/service/impl/ProductServiceImpl.java</span>

<span class="c1">// ... imports ...</span>
<span class="kn">import</span> <span class="nn">org.springframework.data.domain.Page</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.data.domain.PageRequest</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.data.domain.Sort</span><span class="o">;</span>

<span class="nd">@Service</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ProductServiceImpl</span> <span class="kd">implements</span> <span class="nc">ProductService</span> <span class="o">{</span>

    <span class="nd">@Autowired</span>
    <span class="kd">private</span> <span class="nc">ProductRepository</span> <span class="n">productRepository</span><span class="o">;</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="nc">Page</span><span class="o">&lt;</span><span class="nc">Product</span><span class="o">&gt;</span> <span class="nf">getAllProductsPagedAndSorted</span><span class="o">(</span><span class="kt">int</span> <span class="n">pageNo</span><span class="o">,</span> <span class="kt">int</span> <span class="n">pageSize</span><span class="o">,</span> <span class="nc">String</span> <span class="n">sortBy</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">// Create a PageRequest object for pagination and sorting</span>
        <span class="nc">PageRequest</span> <span class="n">pageable</span> <span class="o">=</span> <span class="nc">PageRequest</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="n">pageNo</span><span class="o">,</span> <span class="n">pageSize</span><span class="o">,</span> <span class="nc">Sort</span><span class="o">.</span><span class="na">by</span><span class="o">(</span><span class="n">sortBy</span><span class="o">).</span><span class="na">descending</span><span class="o">());</span>

        <span class="c1">// Use findAll(Pageable) provided by JpaRepository</span>
        <span class="k">return</span> <span class="n">productRepository</span><span class="o">.</span><span class="na">findAll</span><span class="o">(</span><span class="n">pageable</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="c1">// ... other methods ...</span>
<span class="o">}</span>
</code></pre></div></div><p><br/></p><h4 id="controller-productcontroller">Controller (<code class="language-plaintext highlighter-rouge">ProductController</code>)</h4><div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// src/main/java/com/geekmonks/controller/ProductController.java</span>

<span class="c1">// ... imports ...</span>
<span class="kn">import</span> <span class="nn">org.springframework.data.domain.Page</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.http.ResponseEntity</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.*</span><span class="o">;</span>

<span class="nd">@RestController</span>
<span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">"/api/products"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ProductController</span> <span class="o">{</span>

    <span class="nd">@Autowired</span>
    <span class="kd">private</span> <span class="nc">ProductService</span> <span class="n">productService</span><span class="o">;</span>

    <span class="nd">@GetMapping</span><span class="o">(</span><span class="s">"/paged"</span><span class="o">)</span>
    <span class="kd">public</span> <span class="nc">ResponseEntity</span><span class="o">&lt;</span><span class="nc">Page</span><span class="o">&lt;</span><span class="nc">Product</span><span class="o">&gt;&gt;</span> <span class="nf">getProducts</span><span class="o">(</span>
            <span class="nd">@RequestParam</span><span class="o">(</span><span class="n">defaultValue</span> <span class="o">=</span> <span class="s">"0"</span><span class="o">)</span> <span class="kt">int</span> <span class="n">page</span><span class="o">,</span>
            <span class="nd">@RequestParam</span><span class="o">(</span><span class="n">defaultValue</span> <span class="o">=</span> <span class="s">"10"</span><span class="o">)</span> <span class="kt">int</span> <span class="n">size</span><span class="o">,</span>
            <span class="nd">@RequestParam</span><span class="o">(</span><span class="n">defaultValue</span> <span class="o">=</span> <span class="s">"productId"</span><span class="o">)</span> <span class="nc">String</span> <span class="n">sort</span><span class="o">)</span> <span class="o">{</span>

        <span class="nc">Page</span><span class="o">&lt;</span><span class="nc">Product</span><span class="o">&gt;</span> <span class="n">productsPage</span> <span class="o">=</span> <span class="n">productService</span><span class="o">.</span><span class="na">getAllProductsPagedAndSorted</span><span class="o">(</span><span class="n">page</span><span class="o">,</span> <span class="n">size</span><span class="o">,</span> <span class="n">sort</span><span class="o">);</span>
        <span class="k">return</span> <span class="nc">ResponseEntity</span><span class="o">.</span><span class="na">ok</span><span class="o">(</span><span class="n">productsPage</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div><hr/><p><br/></p><h2 id="-custom-queries-jpqlsql-implementation">üîç Custom Queries (JPQL/SQL) Implementation</h2><p>When query derivation by method name becomes too complex or involves <strong>custom logic, aggregates, or joins</strong> not easily expressed, the <strong><code class="language-plaintext highlighter-rouge">@Query</code></strong> annotation is used. It allows defining queries using <strong>JPQL (Java Persistence Query Language)</strong> or <strong>Native SQL</strong>.</p><ul><li><strong><code class="language-plaintext highlighter-rouge">Use Case:</code></strong> Fetching products whose prices are between two values and belong to a specific category, or executing complex join operations.</li><li><strong><code class="language-plaintext highlighter-rouge">Benefits:</code></strong> Provides <strong>full control</strong> over the executed query, allows using <strong>named parameters</strong> for safety, and supports more complex SQL features (like stored procedures via Native SQL).</li></ul><p><br/></p><h3 id="-code-implementation">üìù Code Implementation</h3><h4 id="repository-productrepository-1">Repository (<code class="language-plaintext highlighter-rouge">ProductRepository</code>)</h4><div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// src/main/java/com/geekmonks/repository/ProductRepository.java</span>

<span class="c1">// ... imports ...</span>
<span class="kn">import</span> <span class="nn">org.springframework.data.jpa.repository.Query</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.data.repository.query.Param</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">ProductRepository</span> <span class="kd">extends</span> <span class="nc">JpaRepository</span><span class="o">&lt;</span><span class="nc">Product</span><span class="o">,</span> <span class="nc">Long</span><span class="o">&gt;</span> <span class="o">{</span>
    
    <span class="c1">// 1. JPQL Example: Uses entity and field names (case sensitive)</span>
    <span class="nd">@Query</span><span class="o">(</span><span class="s">"SELECT p FROM Product p WHERE p.category = :category AND p.price BETWEEN :minPrice AND :maxPrice"</span><span class="o">)</span>
    <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Product</span><span class="o">&gt;</span> <span class="nf">findByCategoryAndPriceRangeJpql</span><span class="o">(</span>
            <span class="nd">@Param</span><span class="o">(</span><span class="s">"category"</span><span class="o">)</span> <span class="nc">String</span> <span class="n">category</span><span class="o">,</span> 
            <span class="nd">@Param</span><span class="o">(</span><span class="s">"minPrice"</span><span class="o">)</span> <span class="nc">Double</span> <span class="n">minPrice</span><span class="o">,</span> 
            <span class="nd">@Param</span><span class="o">(</span><span class="s">"maxPrice"</span><span class="o">)</span> <span class="nc">Double</span> <span class="n">maxPrice</span><span class="o">);</span>

    <span class="c1">// 2. Native SQL Example: Uses table and column names (as per DB schema)</span>
    <span class="nd">@Query</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">"SELECT * FROM product p WHERE p.product_name LIKE %:name%"</span><span class="o">,</span> <span class="n">nativeQuery</span> <span class="o">=</span> <span class="kc">true</span><span class="o">)</span>
    <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Product</span><span class="o">&gt;</span> <span class="nf">findProductsByNameNative</span><span class="o">(</span><span class="nd">@Param</span><span class="o">(</span><span class="s">"name"</span><span class="o">)</span> <span class="nc">String</span> <span class="n">namePart</span><span class="o">);</span>
<span class="o">}</span>
</code></pre></div></div><p><br/></p><h4 id="service-implementation-productserviceimpl-1">Service Implementation (<code class="language-plaintext highlighter-rouge">ProductServiceImpl</code>)</h4><div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// src/main/java/com/geekmonks/service/impl/ProductServiceImpl.java</span>

<span class="c1">// ... imports ...</span>

<span class="nd">@Service</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ProductServiceImpl</span> <span class="kd">implements</span> <span class="nc">ProductService</span> <span class="o">{</span>

    <span class="nd">@Autowired</span>
    <span class="kd">private</span> <span class="nc">ProductRepository</span> <span class="n">productRepository</span><span class="o">;</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Product</span><span class="o">&gt;</span> <span class="nf">findProductsByCategoryAndRange</span><span class="o">(</span><span class="nc">String</span> <span class="n">category</span><span class="o">,</span> <span class="nc">Double</span> <span class="n">min</span><span class="o">,</span> <span class="nc">Double</span> <span class="n">max</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">productRepository</span><span class="o">.</span><span class="na">findByCategoryAndPriceRangeJpql</span><span class="o">(</span><span class="n">category</span><span class="o">,</span> <span class="n">min</span><span class="o">,</span> <span class="n">max</span><span class="o">);</span>
    <span class="o">}</span>
    
    <span class="c1">// ... other methods ...</span>
<span class="o">}</span>
</code></pre></div></div><hr/><p><br/></p><h2 id="-optimistic-locking-version-control">üîí Optimistic Locking (Version Control)</h2><p><strong><code class="language-plaintext highlighter-rouge">Optimistic Locking</code></strong> is a concurrency control mechanism used to prevent lost updates in a multi-user environment without holding long-term database locks. It assumes that multiple transactions rarely conflict. It is implemented by adding a <strong>version field</strong> (usually an integer) to the entity, annotated with <strong><code class="language-plaintext highlighter-rouge">@Version</code></strong>.</p><ul><li><strong><code class="language-plaintext highlighter-rouge">Use Case:</code></strong> Updating a shared resource, like a product‚Äôs inventory count, where multiple users might try to modify the record simultaneously.</li><li><strong><code class="language-plaintext highlighter-rouge">Benefits:</code></strong><strong>High concurrency</strong> and <strong>scalability</strong> since database locks are avoided. If a conflict is detected (the version number doesn‚Äôt match), JPA throws an <strong><code class="language-plaintext highlighter-rouge">ObjectOptimisticLockingFailureException</code></strong>, and the application can retry the transaction.</li></ul><p><br/></p><h3 id="-code-implementation-1">üìù Code Implementation</h3><h4 id="entity-class-product">Entity Class (<code class="language-plaintext highlighter-rouge">Product</code>)</h4><div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// src/main/java/com/geekmonks/entity/Product.java</span>

<span class="c1">// ... imports ...</span>
<span class="kn">import</span> <span class="nn">jakarta.persistence.Version</span><span class="o">;</span>

<span class="nd">@Entity</span>
<span class="nd">@Table</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"product"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Product</span> <span class="o">{</span>
    
    <span class="c1">// ... existing fields ...</span>
    
    <span class="nd">@Version</span> <span class="c1">// JPA manages this field automatically</span>
    <span class="kd">private</span> <span class="nc">Integer</span> <span class="n">version</span><span class="o">;</span>

    <span class="c1">// ... getters and setters for version (optional, but good practice) ...</span>
<span class="o">}</span>
</code></pre></div></div><p><br/></p><h4 id="service-implementation-productserviceimpl-2">Service Implementation (<code class="language-plaintext highlighter-rouge">ProductServiceImpl</code>)</h4><div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// src/main/java/com/geekmonks/service/impl/ProductServiceImpl.java</span>

<span class="c1">// ... imports ...</span>
<span class="kn">import</span> <span class="nn">org.springframework.orm.ObjectOptimisticLockingFailureException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.transaction.annotation.Transactional</span><span class="o">;</span>

<span class="nd">@Service</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ProductServiceImpl</span> <span class="kd">implements</span> <span class="nc">ProductService</span> <span class="o">{</span>

    <span class="nd">@Autowired</span>
    <span class="kd">private</span> <span class="nc">ProductRepository</span> <span class="n">productRepository</span><span class="o">;</span>

    <span class="nd">@Transactional</span>
    <span class="kd">public</span> <span class="nc">Product</span> <span class="nf">updateProductPrice</span><span class="o">(</span><span class="nc">Long</span> <span class="n">productId</span><span class="o">,</span> <span class="nc">Double</span> <span class="n">newPrice</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">Product</span> <span class="n">product</span> <span class="o">=</span> <span class="n">productRepository</span><span class="o">.</span><span class="na">findById</span><span class="o">(</span><span class="n">productId</span><span class="o">)</span>
            <span class="o">.</span><span class="na">orElseThrow</span><span class="o">(()</span> <span class="o">-&gt;</span> <span class="k">new</span> <span class="nc">RuntimeException</span><span class="o">(</span><span class="s">"Product not found"</span><span class="o">));</span>

        <span class="c1">// Simulate a scenario where another transaction might have updated it</span>
        <span class="c1">// and the version number in the database is now different from the one </span>
        <span class="c1">// loaded by this transaction.</span>

        <span class="n">product</span><span class="o">.</span><span class="na">setPrice</span><span class="o">(</span><span class="n">newPrice</span><span class="o">);</span>
        
        <span class="k">try</span> <span class="o">{</span>
            <span class="k">return</span> <span class="n">productRepository</span><span class="o">.</span><span class="na">save</span><span class="o">(</span><span class="n">product</span><span class="o">);</span> <span class="c1">// This will check the @Version field</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">ObjectOptimisticLockingFailureException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="c1">// Handle the conflict, typically by logging and retrying the transaction</span>
            <span class="c1">// or informing the user to retry the operation.</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nf">RuntimeException</span><span class="o">(</span><span class="s">"Update failed due to concurrent modification. Please retry."</span><span class="o">,</span> <span class="n">e</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div><hr/><p><br/></p><h2 id="-observability">üìà Observability</h2><p>In enterprise applications, <strong><code class="language-plaintext highlighter-rouge">observability</code></strong> (understanding the internal state from external outputs) is key. For a data access layer using Spring Data JPA, this primarily involves:</p><table><thead><tr><th style="text-align: left">Approach</th><th style="text-align: left">Key Activity / Tools Used</th><th style="text-align: left">Primary Goal</th></tr></thead><tbody><tr><td style="text-align: left"><strong>Tracing</strong></td><td style="text-align: left">Use <strong><code class="language-plaintext highlighter-rouge">Sleuth/Micrometer</code> Tracing</strong> (or <strong><code class="language-plaintext highlighter-rouge">OpenTelemetry</code></strong>) to trace requests.</td><td style="text-align: left">Capture the <strong>end-to-end flow</strong> of a request, specifically isolating the <strong>time spent in the database</strong> to locate slow operations.</td></tr><tr><td style="text-align: left"><strong>Metrics (Monitoring)</strong></td><td style="text-align: left">Collect <strong>database connection pool metrics</strong> and monitor the <strong>duration/count of repository method calls</strong> via <strong><code class="language-plaintext highlighter-rouge">Micrometer</code></strong> and <strong><code class="language-plaintext highlighter-rouge">Actuator</code></strong>.</td><td style="text-align: left">Assess the <strong><code class="language-plaintext highlighter-rouge">performance and resource utilization</code></strong> of the data access layer (e.g., connection saturation).</td></tr><tr><td style="text-align: left"><strong>Logging</strong></td><td style="text-align: left">Configure <strong>Hibernate SQL logging</strong> (<code class="language-plaintext highlighter-rouge">logging.level.org.hibernate.SQL=debug</code>) and use a structured format (e.g., JSON).</td><td style="text-align: left">Enables engineers to see the <strong>actual SQL query</strong> being executed along with parameters for debugging and performance analysis.</td></tr><tr><td style="text-align: left"><strong>Application Performance Monitoring (APM)</strong></td><td style="text-align: left">Integrate commercial tools like <strong><code class="language-plaintext highlighter-rouge">New Relelc, Dynatrace, or DataDog</code></strong>.</td><td style="text-align: left">Provides <strong>automatic instrumentation</strong> of JPA/Hibernate calls and deep-dive transaction analysis, including detection of the N+1 problem.</td></tr></tbody></table><hr/><h2 id="-key-awareness-points-for-experienced-engineers">üß† Key Awareness Points for Experienced Engineers</h2><table><thead><tr><th style="text-align: left">Area of Awareness</th><th style="text-align: left">Description and Impact</th><th style="text-align: left">Recommended Action</th></tr></thead><tbody><tr><td style="text-align: left"><strong><code class="language-plaintext highlighter-rouge">Transaction Boundaries</code></strong></td><td style="text-align: left">Improper placement of <strong><code class="language-plaintext highlighter-rouge">@Transactional</code></strong> leads to issues like <strong><code class="language-plaintext highlighter-rouge">LazyInitializationException</code></strong> or inefficient resource handling.</td><td style="text-align: left">Place <code class="language-plaintext highlighter-rouge">@Transactional</code> primarily on the <strong>Service Layer</strong> methods to define clear transaction scope.</td></tr><tr><td style="text-align: left"><strong><code class="language-plaintext highlighter-rouge">The N+1 Select Problem</code></strong></td><td style="text-align: left">The most common performance anti-pattern, resulting in <strong>N+1 database queries</strong> (1 parent + N children queries).</td><td style="text-align: left"><strong>Always use <code class="language-plaintext highlighter-rouge">FETCH JOIN</code> in JPQL</strong> or <strong><code class="language-plaintext highlighter-rouge">EntityGraphs</code></strong> to eagerly fetch required associations in a single query.</td></tr><tr><td style="text-align: left"><strong><code class="language-plaintext highlighter-rouge">Dirty Checking</code></strong></td><td style="text-align: left">JPA automatically detects and persists changes to <strong>managed entities</strong> inside a transaction, even without calling <code class="language-plaintext highlighter-rouge">save()</code>.</td><td style="text-align: left">Be aware that any modification to a managed entity will result in an <strong>automatic database update</strong> at the transaction commit.</td></tr><tr><td style="text-align: left"><strong><code class="language-plaintext highlighter-rouge">Batching Updates/Inserts</code></strong></td><td style="text-align: left">Standard JPA operations can be slow for high-volume data inserts or updates.</td><td style="text-align: left">Configure <strong>Hibernate for JDBC batching</strong> (e.g., set <code class="language-plaintext highlighter-rouge">spring.jpa.properties.hibernate.jdbc.batch_size</code>) and use batch methods like <code class="language-plaintext highlighter-rouge">saveAll()</code> effectively.</td></tr></tbody></table><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code></code></pre></div></div></div></main></div></div><div><footer class="row row-cols-1 row-cols-sm-2 row-cols-md-5 py-4 mx-5 my-5 border-top"><div class="col-md-4 d-flex align-items-center"><a href="/geekmonks/" class="mb-3 me-2 mb-md-0 text-body-secondary text-decoration-none lh-1" aria-label="Geekmonks"><svg class="bi me-2" width="40" height="32" aria-hidden="true" viewBox="0 0 200 200"><defs><linearGradient id="gradient" gradientTransform="rotate(145 0.5 0.5)"><stop offset="0%" stop-color="#f7e625"></stop><stop offset="100%" stop-color="#e6a62c"></stop></linearGradient></defs><rect width="200" height="200" fill="url('#gradient')"></rect><g fill="#303e37" transform="matrix(12.312625250501002,0,0,12.312625250501002,16.825404661093543,187.54701945968048)" stroke="#3b8349" stroke-width="0.2"><path d="M12.71-7.60L12.71-1.76Q11.92-0.88 10.40-0.34Q8.88 0.20 7.06 0.20L7.06 0.20Q4.27 0.20 2.60-1.51Q0.93-3.22 0.81-6.27L0.81-6.27L0.80-7.50Q0.80-9.60 1.54-11.17Q2.29-12.73 3.67-13.58Q5.05-14.42 6.87-14.42L6.87-14.42Q9.52-14.42 10.99-13.21Q12.46-11.99 12.71-9.58L12.71-9.58L9.40-9.58Q9.23-10.77 8.64-11.28Q8.06-11.79 6.98-11.79L6.98-11.79Q5.69-11.79 4.99-10.69Q4.29-9.60 4.28-7.57L4.28-7.57L4.28-6.71Q4.28-4.58 5.00-3.51Q5.73-2.44 7.29-2.44L7.29-2.44Q8.63-2.44 9.29-3.04L9.29-3.04L9.29-5.24L6.90-5.24L6.90-7.60L12.71-7.60Z"></path></g></svg></a><span class="mb-3 mb-md-0 text-body-secondary">¬© 2025 Company, Inc</span></div><div class="col mb-3"></div><div class="col mb-3"><h5>Company</h5><ul class="nav col-md-4"><li class="nav-item"><a href="/geekmonks/" class="nav-link px-2 text-body-secondary">Home</a></li><li class="nav-item"><a href="/geekmonks/about" class="nav-link px-2 text-body-secondary">About</a></li><li class="nav-item"><a href="https://github.com/SRVivek1/" target="_blank" class="nav-link px-2 text-body-secondary">Github</a></li><li class="nav-item"><a href="https://www.linkedin.com/in/srvivek1/" target="_blank" class="nav-link px-2 text-body-secondary">LinkedIn</a></li></ul></div><div class="col mb-3"><h5>Tutorials</h5><ul class="nav flex-column"><li class="nav-item mb-2"><a href="/geekmonks/spring/spring-boot" class="nav-link p-0 text-body-secondary">Spring Boot</a></li><li class="nav-item mb-2"><a href="/geekmonks/ai-ml/llm-engineering" class="nav-link p-0 text-body-secondary">AI / ML</a></li><li class="nav-item mb-2"><a href="/geekmonks/cloud/aws" class="nav-link p-0 text-body-secondary">AWS</a></li></ul></div></footer></div><script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script><script src="/geekmonks/assets/js/mermaid-diagram-render.js?v=0.1.0"></script><script src="/geekmonks/assets/js/submenu-togle.js?v=0.1.0"></script></body></html>