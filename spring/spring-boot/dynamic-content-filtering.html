<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="keywords" content="geekmonks, geek, tech, geekmonks tech, free tutorial, free online tutorial"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"><meta name="apple-mobile-web-app-title" content="Geekmonks Tech"><meta name="mobile-web-app-capable" content="yes"><link type="application/atom+xml" rel="alternate" href="https://srvivek1.github.io/geekmonks/feed.xml" title="Geekmonks Tech"/><title>üõ°Ô∏è Dynamic Response Filtering | Geekmonks Tech</title><meta name="generator" content="Jekyll v3.10.0"/><meta property="og:title" content="üõ°Ô∏è Dynamic Response Filtering"/><meta property="og:locale" content="en_US"/><meta name="description" content="Geekmonks Tech - Spring Tutorial, Spring Boot Tutorial, Free Spring Boot tutorial, Free Online Tutorials, geekmonks provides tutorials and interview questions for Spring Boot, Spring, controllers, rest controllers, api, static content filtering, dynamic content filtering etc. for beginners and professionals."/><meta property="og:description" content="Geekmonks Tech - Spring Tutorial, Spring Boot Tutorial, Free Spring Boot tutorial, Free Online Tutorials, geekmonks provides tutorials and interview questions for Spring Boot, Spring, controllers, rest controllers, api, static content filtering, dynamic content filtering etc. for beginners and professionals."/><link rel="canonical" href="https://srvivek1.github.io/geekmonks/spring/spring-boot/dynamic-content-filtering.html"/><meta property="og:url" content="https://srvivek1.github.io/geekmonks/spring/spring-boot/dynamic-content-filtering.html"/><meta property="og:site_name" content="Geekmonks Tech"/><meta property="og:type" content="article"/><meta property="article:published_time" content="2024-11-18T15:00:00+05:30"/><meta name="twitter:card" content="summary"/><meta property="twitter:title" content="üõ°Ô∏è Dynamic Response Filtering"/><meta name="twitter:site" content="@srvivek_"/><script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2024-11-18T15:00:00+05:30","datePublished":"2024-11-18T15:00:00+05:30","description":"Geekmonks Tech - Spring Tutorial, Spring Boot Tutorial, Free Spring Boot tutorial, Free Online Tutorials, geekmonks provides tutorials and interview questions for Spring Boot, Spring, controllers, rest controllers, api, static content filtering, dynamic content filtering etc. for beginners and professionals.","headline":"üõ°Ô∏è Dynamic Response Filtering","mainEntityOfPage":{"@type":"WebPage","@id":"https://srvivek1.github.io/geekmonks/spring/spring-boot/dynamic-content-filtering.html"},"url":"https://srvivek1.github.io/geekmonks/spring/spring-boot/dynamic-content-filtering.html"}</script><script async src="https://www.googletagmanager.com/gtag/js?id=G-48XEHMVSEC"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date);gtag("config","G-48XEHMVSEC");</script><link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet"><link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet"><link rel="stylesheet" href="/geekmonks/assets/css/styles.css?v=0.1.0"><meta name="google-site-verification" content="jZc8FClWZ59HztGd1eJpYfr8XkjbP1oU_qlWQ02UHRM"/></head><body class="container-fluid p-0 m-0"><header><nav class="navbar navbar-expand-md navbar-light bg-light text-white content-shadow"><div class="container d-flex justify-content-between"><a href="/geekmonks/" class="navbar-brand d-flex"><img class="d-inline-block align-top" src="/geekmonks/assets/icons/laptop.svg" height="40" width="34" alt="banner-1 laptop icon"/><h1 class="fs-3 px-2 fw-bold">Geekmonks</h1><img class="d-inline-block align-top" src="/geekmonks/assets/icons/tux.svg" height="40" width="34" alt="banner-2 penguine icon"/></a><button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNavBanner" aria-controls="navbarNavBanner" aria-expanded="false" aria-label="Toggle Navigation"><span class="navbar-toggler-icon"></span></button><div id="navbarNavBanner" class="collapse navbar-collapse"><ul class="navbar-nav ms-auto"><li class="nav-item active"><a href="/geekmonks/" class="nav-link fw-bold active">Home</a></li><li class="nav-item active"><a href="/geekmonks/about" class="nav-link fw-bold active">About</a></li><li class="nav-item active"><a href="https://github.com/SRVivek1/" class="nav-link fw-bold active" target="_blank" rel="noopener noreferrer">Github</a></li><li class="nav-item active"><a href="https://www.linkedin.com/in/srvivek1/" class="nav-link fw-bold active" target="_blank" rel="noopener noreferrer">LinkedIn</a></li></ul></div></div></nav><nav class="navbar navbar-expand-xl navbar-custom p-0"><div class="container-fluid"><button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarNav"><ul class="navbar-nav mx-auto"><li class="nav-item"><a class="nav-link fw-bold text-white" href="/geekmonks/ai-ml/llm-engineering/">AI-ML</a></li><li class="nav-item"><a class="nav-link fw-bold text-white" href="/geekmonks/cloud/aws/">AWS</a></li><li class="nav-item"><a class="nav-link fw-bold text-white" href="/geekmonks/spring/spring-boot/">Spring Boot</a></li></ul></div></div></nav></header><div class="container-fluid"><div class="row min-vh-100"><nav id="course-sidebar" class="col-md-3 col-lg-2 d-md-block sidebar collapse"><div class="position-sticky pt-3"><ul class="nav flex-column course-topics-list"><a class="nav-link course-link active" href="/geekmonks/spring/spring-boot" data-course="spring/spring-boot"> Spring Boot </a><ul class="nav flex-column ms-2 subtopics" id="topics-spring-spring-boot"><li class="nav-item" style="text-align: left"><a class="nav-link topic-link small " href="getting-started.html" data-topic="getting-started.html" data-course-path="/spring/spring-boot"> Getting Started </a></li><li class="nav-item" style="text-align: left"><a class="nav-link topic-link small " href="rest-api-validation.html" data-topic="rest-api-validation.html" data-course-path="/spring/spring-boot"> API Validation </a></li><li class="nav-item" style="text-align: left"><a class="nav-link topic-link small " href="swagger-api-doc.html" data-topic="swagger-api-doc.html" data-course-path="/spring/spring-boot"> API Documentation </a></li><li class="nav-item" style="text-align: left"><a class="nav-link topic-link small " href="content-negotiation.html" data-topic="content-negotiation.html" data-course-path="/spring/spring-boot"> Content Negotiation </a></li><li class="nav-item" style="text-align: left"><a class="nav-link topic-link small " href="i18n.html" data-topic="i18n.html" data-course-path="/spring/spring-boot"> Internationalization (i18n) </a></li><li class="nav-item" style="text-align: left"><a class="nav-link topic-link small " href="rest-api-versioning.html" data-topic="rest-api-versioning.html" data-course-path="/spring/spring-boot"> API Versioning </a></li><li class="nav-item" style="text-align: left"><a class="nav-link topic-link small " href="rest-api-retirement.html" data-topic="rest-api-retirement.html" data-course-path="/spring/spring-boot"> API Retirement Strategy </a></li><li class="nav-item" style="text-align: left"><a class="nav-link topic-link small " href="hateoas.html" data-topic="hateoas.html" data-course-path="/spring/spring-boot"> HATEOAS </a></li><li class="nav-item" style="text-align: left"><a class="nav-link topic-link small " href="static-content-filtering.html" data-topic="static-content-filtering.html" data-course-path="/spring/spring-boot"> Static Content Filtering </a></li><li class="nav-item" style="text-align: left"><a class="nav-link topic-link small active" href="dynamic-content-filtering.html" data-topic="dynamic-content-filtering.html" data-course-path="/spring/spring-boot"> Dynamic Content Filtering </a></li><li class="nav-item" style="text-align: left"><a class="nav-link topic-link small " href="client-driven-filtering.html" data-topic="client-driven-filtering.html" data-course-path="/spring/spring-boot"> Client-Driven Filtering </a></li><li class="nav-item" style="text-align: left"><a class="nav-link topic-link small " href="exception-error-handling.html" data-topic="exception-error-handling.html" data-course-path="/spring/spring-boot"> Controller Error Handling </a></li><li class="nav-item" style="text-align: left"><a class="nav-link topic-link small " href="hal-explorer.html" data-topic="hal-explorer.html" data-course-path="/spring/spring-boot"> HAL Explorer </a></li><li class="nav-item" style="text-align: left"><a class="nav-link topic-link small " href="spring-data-jpa.html" data-topic="spring-data-jpa.html" data-course-path="/spring/spring-boot"> Spring Data JPA </a></li><li class="nav-item" style="text-align: left"><a class="nav-link topic-link small " href="jpa-with-h2-db.html" data-topic="jpa-with-h2-db.html" data-course-path="/spring/spring-boot"> JPA with H2 DB </a></li><li class="nav-item" style="text-align: left"><a class="nav-link topic-link small " href="jpa-with-mysql-db.html" data-topic="jpa-with-mysql-db.html" data-course-path="/spring/spring-boot"> JPA with MySQL DB </a></li><li class="nav-item" style="text-align: left"><a class="nav-link topic-link small " href="jpa-jdbc-template.html" data-topic="jpa-jdbc-template.html" data-course-path="/spring/spring-boot"> JPA & JDBC Teamplate </a></li><li class="nav-item" style="text-align: left"><a class="nav-link topic-link small " href="spring-security-basics.html" data-topic="spring-security-basics.html" data-course-path="/spring/spring-boot"> Spring Security </a></li></ul></ul></div></nav><main class="col-md-9 ms-sm-auto col-lg-10 px-md-4"><button id="sidebarToggle" class="btn btn-sm btn-outline-secondary d-md-none mb-2" aria-label="Toggle topics" aria-controls="course-sidebar"> ‚ò∞ Topics </button><div id="topic-content"><div id="pageTitle"><h1>üõ°Ô∏è Dynamic Response Filtering</h1><p style="font-style: italic;"> Updated on: 18 Nov 2024 - <a href="/geekmonks/authors/srvivek/">Vivek Singh</a></p><hr class="stylish-hr"/></div><h2 id="-table-of-contents">üìë Table of Contents</h2><ul><li><a href="#-table-of-contents">üìë Table of Contents</a></li><li><a href="#-introduction-to-dynamic-response-filtering">üöÄ Introduction to Dynamic Response Filtering</a></li><li><a href="#-purpose-use-case-features-benefits-and-drawbacks">üåü Purpose, Use Case, Features, Benefits, and Drawbacks</a></li><li><a href="#-security-concerns">üîí Security Concerns</a></li><li><a href="#-best-practices-and-suggestions">üèÜ Best Practices and Suggestions</a></li><li><a href="#-alternative-approach">üîÑ Alternative Approach</a></li><li><a href="#Ô∏è-maven-dependency">üõ†Ô∏è Maven Dependency</a><ul><li><a href="#pomxml"><code class="language-plaintext highlighter-rouge">pom.xml</code></a></li></ul></li><li><a href="#-code-implementation">üíª Code Implementation</a><ul><li><a href="#data-bean-jsonfilter">Data Bean (<code class="language-plaintext highlighter-rouge">@JsonFilter</code>)</a></li><li><a href="#somebeandynamicfilterjava"><code class="language-plaintext highlighter-rouge">SomeBeanDynamicFilter.java</code></a></li><li><a href="#rest-controller-mappingjacksonvalue">REST Controller (<code class="language-plaintext highlighter-rouge">MappingJacksonValue</code>)</a></li><li><a href="#dynamicfilteringcontrollerjava"><code class="language-plaintext highlighter-rouge">DynamicFilteringController.java</code></a></li><li><a href="#project-poc">Project POC</a></li></ul></li><li><a href="#-observations-and-insights">üîç Observations and Insights</a></li><li><a href="#-expert-advice-what-engineers-should-be-aware-of">üí° Expert Advice: What Engineers Should Be Aware Of</a></li><li><a href="#Ô∏è-architecture-diagram">üèóÔ∏è Architecture Diagram</a></li></ul><hr/><h2 id="-introduction-to-dynamic-response-filtering">üöÄ Introduction to Dynamic Response Filtering</h2><p>In modern microservices, <strong>Content Filtering</strong> is vital for security and performance. This technique, leveraging <strong>Jackson‚Äôs <code class="language-plaintext highlighter-rouge">@JsonFilter</code></strong> in Spring Boot, allows you to <strong>dynamically control</strong> which properties of a Java Bean are included in the JSON response. By using the Spring utility <strong><code class="language-plaintext highlighter-rouge">MappingJacksonValue</code></strong>, we can apply specific filters per API endpoint at <strong>runtime</strong>. This approach is crucial for preventing <strong>data over-fetching</strong> and exposing sensitive internal fields.</p><hr/><h2 id="-purpose-use-case-features-benefits-and-drawbacks">üåü Purpose, Use Case, Features, Benefits, and Drawbacks</h2><table><thead><tr><th style="text-align: left">Aspect</th><th style="text-align: left">Description</th></tr></thead><tbody><tr><td style="text-align: left"><strong>Purpose / Feature</strong></td><td style="text-align: left"><strong>Content Filtering</strong> refers to dynamically selecting or removing specific properties from a JSON response object before sending it to the client. This is achieved using <strong>Jackson‚Äôs <code class="language-plaintext highlighter-rouge">@JsonFilter</code></strong> mechanism.</td></tr><tr><td style="text-align: left"><strong>Use Case</strong></td><td style="text-align: left">Ideal for APIs where <strong>different endpoints</strong> need to return the <strong>same Java Bean</strong> but with <strong>varying subsets of fields</strong> (e.g., an <code class="language-plaintext highlighter-rouge">/users</code> list endpoint needs <em>name</em> and <em>ID</em>, but a <code class="language-plaintext highlighter-rouge">/users/{id}</code> detail endpoint also needs <em>address</em> and <em>roles</em>).</td></tr><tr><td style="text-align: left"><strong>Benefits</strong></td><td style="text-align: left"><strong>Security</strong> (Prevents exposure of sensitive internal fields), <strong>Performance</strong> (Reduces payload size, thus reducing network bandwidth and processing time), <strong>Flexibility</strong> (Allows filtering logic to be determined at runtime per API request).</td></tr><tr><td style="text-align: left"><strong>Drawbacks</strong></td><td style="text-align: left"><strong>Code Complexity</strong> (Requires extra setup in the Controller using <code class="language-plaintext highlighter-rouge">MappingJacksonValue</code> and filter providers, making the controller code less clean), <strong>Maintainability</strong> (Requires diligent management of filter names and fields across multiple endpoints).</td></tr><tr><td style="text-align: left"><strong>Prerequisite</strong></td><td style="text-align: left">This feature is part of <code class="language-plaintext highlighter-rouge">jackson-annotations-${version}.jar</code>, implicitly included via the <code class="language-plaintext highlighter-rouge">spring-boot-starter-web</code> dependency.</td></tr></tbody></table><hr/><h2 id="-security-concerns">üîí Security Concerns</h2><ul><li><strong>Accidental Data Exposure:</strong> The primary risk is forgetting to apply a filter or applying an incorrect filter, leading to the <strong>unintentional exposure of sensitive fields</strong> (like passwords, internal IDs, or financial data) to an unauthorized client.</li><li><strong>Filter Name Mismatch:</strong> A mismatch between the <strong><code class="language-plaintext highlighter-rouge">@JsonFilter</code> name</strong> on the Bean and the name registered in the <strong><code class="language-plaintext highlighter-rouge">SimpleFilterProvider</code></strong> will result in the entire bean being serialized, potentially bypassing all filtering logic.</li><li><strong>Security by Obscurity:</strong> Relying solely on filtering for security is discouraged. Response filtering should complement <strong>robust authentication and authorization</strong> mechanisms, and not to replace them.</li></ul><hr/><h2 id="-best-practices-and-suggestions">üèÜ Best Practices and Suggestions</h2><ol><li><strong>Prioritize Static Filtering:</strong><ul><li>For fields that <strong>should <em>never</em> be exposed</strong> (e.g., <code class="language-plaintext highlighter-rouge">passwordHash</code>), use <strong>Static Filtering</strong> (<code class="language-plaintext highlighter-rouge">@JsonIgnore</code>, <code class="language-plaintext highlighter-rouge">@JsonIgnoreProperties</code>). Dynamic filtering should only be used for fields whose inclusion depends on the specific API call.</li></ul></li><li><strong>Use Enums/Constants:</strong><ul><li>Define the filter names (e.g., <code class="language-plaintext highlighter-rouge">"dyna-filter-for-somebean"</code>) as <strong>public static final constants</strong> in a utility class or the Bean itself to prevent spelling mistakes.</li></ul></li><li><strong>Create a Utility Method:</strong><ul><li>Encapsulate the filter creation and application logic (<code class="language-plaintext highlighter-rouge">SimpleBeanPropertyFilter</code>, <code class="language-plaintext highlighter-rouge">SimpleFilterProvider</code>, <code class="language-plaintext highlighter-rouge">MappingJacksonValue</code>) into a <strong>reusable utility method</strong> or a custom <code class="language-plaintext highlighter-rouge">HttpMessageConverter</code> to keep Controller methods cleaner.</li></ul></li><li><strong>Documentation:</strong><ul><li>Clearly document which fields are returned by each API endpoint, especially when dynamic filtering is in use, for better API consumer understanding.</li></ul></li></ol><hr/><h2 id="-alternative-approach">üîÑ Alternative Approach</h2><p>An alternative to dynamic Jackson filtering is to use <strong>Data Transfer Objects (DTOs)</strong>.</p><ul><li><strong>DTO Approach:</strong> For each required subset of fields, create a separate, dedicated DTO class (e.g., <code class="language-plaintext highlighter-rouge">UserSummaryDTO</code>, <code class="language-plaintext highlighter-rouge">UserDetailsDTO</code>).</li><li><strong>Mapping:</strong> The Controller maps the full JPA Entity/Service Bean to the appropriate DTO before returning the response.</li><li><strong>Trade-off:</strong> This approach offers <strong>compile-time safety</strong> and <strong>cleaner controller code</strong> (no <code class="language-plaintext highlighter-rouge">MappingJacksonValue</code> logic) but involves <strong>more boilerplate code</strong> (creating and maintaining multiple DTO classes and mapping logic).</li></ul><hr/><h2 id="Ô∏è-maven-dependency">üõ†Ô∏è Maven Dependency</h2><p>The dynamic filtering feature is provided by Jackson, which is included by default with the <strong><code class="language-plaintext highlighter-rouge">spring-boot-starter-web</code></strong>.</p><h3 id="pomxml"><code class="language-plaintext highlighter-rouge">pom.xml</code></h3><div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;dependency&gt;</span>
    <span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>spring-boot-starter-web<span class="nt">&lt;/artifactId&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
</code></pre></div></div><hr/><h2 id="-code-implementation">üíª Code Implementation</h2><h3 id="data-bean-jsonfilter">Data Bean (<code class="language-plaintext highlighter-rouge">@JsonFilter</code>)</h3><p>The Java Bean is annotated with <code class="language-plaintext highlighter-rouge">@JsonFilter</code> to link it to a named filter.</p><h3 id="somebeandynamicfilterjava"><code class="language-plaintext highlighter-rouge">SomeBeanDynamicFilter.java</code></h3><div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="nn">com.srvivek.sboot.mservices.bean</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.fasterxml.jackson.annotation.JsonFilter</span><span class="o">;</span>

<span class="cm">/** Dynamically exclude properties as per the specified filter set by the API. */</span>
<span class="nd">@JsonFilter</span><span class="o">(</span><span class="s">"dyna-filter-for-somebean"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">SomeBeanDynamicFilter</span> <span class="o">{</span>

    <span class="kd">private</span> <span class="nc">String</span> <span class="n">field1</span><span class="o">;</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">field2</span><span class="o">;</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">field3</span><span class="o">;</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">field4</span><span class="o">;</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">field5</span><span class="o">;</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">field6</span><span class="o">;</span>

    <span class="c1">// constructors, setter-getters and utility methods</span>
    <span class="c1">// (Assuming public constructor SomeBeanDynamicFilter(String... fields) exists)</span>
    <span class="kd">public</span> <span class="nf">SomeBeanDynamicFilter</span><span class="o">(</span><span class="nc">String</span> <span class="n">field1</span><span class="o">,</span> <span class="nc">String</span> <span class="n">field2</span><span class="o">,</span> <span class="nc">String</span> <span class="n">field3</span><span class="o">,</span> <span class="nc">String</span> <span class="n">field4</span><span class="o">,</span> <span class="nc">String</span> <span class="n">field5</span><span class="o">,</span> <span class="nc">String</span> <span class="n">field6</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">field1</span> <span class="o">=</span> <span class="n">field1</span><span class="o">;</span>
        <span class="k">this</span><span class="o">.</span><span class="na">field2</span> <span class="o">=</span> <span class="n">field2</span><span class="o">;</span>
        <span class="k">this</span><span class="o">.</span><span class="na">field3</span> <span class="o">=</span> <span class="n">field3</span><span class="o">;</span>
        <span class="k">this</span><span class="o">.</span><span class="na">field4</span> <span class="o">=</span> <span class="n">field4</span><span class="o">;</span>
        <span class="k">this</span><span class="o">.</span><span class="na">field5</span> <span class="o">=</span> <span class="n">field5</span><span class="o">;</span>
        <span class="k">this</span><span class="o">.</span><span class="na">field6</span> <span class="o">=</span> <span class="n">field6</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="c1">// ... Getters and Setters omitted for brevity</span>
<span class="o">}</span>
</code></pre></div></div><p><br/></p><h3 id="rest-controller-mappingjacksonvalue">REST Controller (<code class="language-plaintext highlighter-rouge">MappingJacksonValue</code>)</h3><p>The controller creates the filter, specifies the included/excluded fields, registers the filter by name, and applies it using <code class="language-plaintext highlighter-rouge">MappingJacksonValue</code>.</p><h3 id="dynamicfilteringcontrollerjava"><code class="language-plaintext highlighter-rouge">DynamicFilteringController.java</code></h3><div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="nn">com.srvivek.sboot.mservices.controller</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.util.Arrays</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.http.converter.json.MappingJacksonValue</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.GetMapping</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.RestController</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.fasterxml.jackson.databind.ser.FilterProvider</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.fasterxml.jackson.databind.ser.impl.SimpleBeanPropertyFilter</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.fasterxml.jackson.databind.ser.impl.SimpleFilterProvider</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.srvivek.sboot.mservices.bean.SomeBeanDynamicFilter</span><span class="o">;</span>

<span class="nd">@RestController</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">DynamicFilteringController</span> <span class="o">{</span>

    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="nc">String</span> <span class="no">FILTER_NAME</span> <span class="o">=</span> <span class="s">"dyna-filter-for-somebean"</span><span class="o">;</span>

    <span class="nd">@GetMapping</span><span class="o">(</span><span class="s">"/dyna-filtering"</span><span class="o">)</span>
    <span class="kd">public</span> <span class="nc">MappingJacksonValue</span> <span class="nf">filtering</span><span class="o">()</span> <span class="o">{</span>

        <span class="c1">// 1. Define fields to keep (filterOutAllExcept)</span>
        <span class="kd">final</span> <span class="nc">SimpleBeanPropertyFilter</span> <span class="n">simpleBeanPropertyFilter</span> <span class="o">=</span> <span class="nc">SimpleBeanPropertyFilter</span><span class="o">.</span><span class="na">filterOutAllExcept</span><span class="o">(</span><span class="s">"field2"</span><span class="o">,</span>
                <span class="s">"field4"</span><span class="o">,</span> <span class="s">"field6"</span><span class="o">);</span>

        <span class="c1">// 2. Register filter with the name defined in the Bean</span>
        <span class="kd">final</span> <span class="nc">SimpleFilterProvider</span> <span class="n">simpleFilterProvider</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">SimpleFilterProvider</span><span class="o">()</span>
                <span class="o">.</span><span class="na">addFilter</span><span class="o">(</span><span class="no">FILTER_NAME</span><span class="o">,</span> <span class="n">simpleBeanPropertyFilter</span><span class="o">);</span>

        <span class="c1">// 3. Construct response bean</span>
        <span class="kd">final</span> <span class="nc">SomeBeanDynamicFilter</span> <span class="n">someBeanDynamicFilter</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">SomeBeanDynamicFilter</span><span class="o">(</span><span class="s">"Value-1"</span><span class="o">,</span> <span class="s">"Value-2"</span><span class="o">,</span> <span class="s">"Value-3"</span><span class="o">,</span>
                <span class="s">"Value-4"</span><span class="o">,</span> <span class="s">"Value-5"</span><span class="o">,</span> <span class="s">"Value-6"</span><span class="o">);</span>

        <span class="c1">// 4. Apply the filter provider to the response bean</span>
        <span class="kd">final</span> <span class="nc">MappingJacksonValue</span> <span class="n">mappingJacksonValue</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">MappingJacksonValue</span><span class="o">(</span><span class="n">someBeanDynamicFilter</span><span class="o">);</span>
        <span class="n">mappingJacksonValue</span><span class="o">.</span><span class="na">setFilters</span><span class="o">(</span><span class="n">simpleFilterProvider</span><span class="o">);</span>

        <span class="k">return</span> <span class="n">mappingJacksonValue</span><span class="o">;</span> <span class="c1">// Returns only field2, field4, field6</span>
    <span class="o">}</span>

    <span class="nd">@GetMapping</span><span class="o">(</span><span class="s">"/dyna-filtering-list"</span><span class="o">)</span>
    <span class="kd">public</span> <span class="nc">MappingJacksonValue</span> <span class="nf">filteringList</span><span class="o">()</span> <span class="o">{</span>

        <span class="c1">// 1. Define a different set of fields to keep for this API</span>
        <span class="nc">SimpleBeanPropertyFilter</span> <span class="n">simpleBeanPropertyFilter</span> <span class="o">=</span> <span class="nc">SimpleBeanPropertyFilter</span><span class="o">.</span><span class="na">filterOutAllExcept</span><span class="o">(</span><span class="s">"field1"</span><span class="o">,</span>
                <span class="s">"field3"</span><span class="o">,</span> <span class="s">"field5"</span><span class="o">,</span> <span class="s">"field6"</span><span class="o">);</span>

        <span class="c1">// 2. Register filter</span>
        <span class="nc">FilterProvider</span> <span class="n">simpleFilterProvider</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">SimpleFilterProvider</span><span class="o">().</span><span class="na">addFilter</span><span class="o">(</span><span class="no">FILTER_NAME</span><span class="o">,</span>
                <span class="n">simpleBeanPropertyFilter</span><span class="o">);</span>

        <span class="c1">// 3. Construct list of response beans</span>
        <span class="nc">List</span><span class="o">&lt;</span><span class="nc">SomeBeanDynamicFilter</span><span class="o">&gt;</span> <span class="nc">SomeBeanDynamicFilterList</span> <span class="o">=</span> <span class="nc">Arrays</span><span class="o">.</span><span class="na">asList</span><span class="o">(</span>
                <span class="k">new</span> <span class="nf">SomeBeanDynamicFilter</span><span class="o">(</span><span class="s">"Value-1"</span><span class="o">,</span> <span class="s">"Value-2"</span><span class="o">,</span> <span class="s">"Value-3"</span><span class="o">,</span> <span class="s">"Value-4"</span><span class="o">,</span> <span class="s">"Value-5"</span><span class="o">,</span> <span class="s">"Value-6"</span><span class="o">),</span>
                <span class="k">new</span> <span class="nf">SomeBeanDynamicFilter</span><span class="o">(</span><span class="s">"Value-11"</span><span class="o">,</span> <span class="s">"Value-22"</span><span class="o">,</span> <span class="s">"Value-33"</span><span class="o">,</span> <span class="s">"Value-44"</span><span class="o">,</span> <span class="s">"Value-55"</span><span class="o">,</span> <span class="s">"Value-66"</span><span class="o">),</span>
                <span class="k">new</span> <span class="nf">SomeBeanDynamicFilter</span><span class="o">(</span><span class="s">"Value-111"</span><span class="o">,</span> <span class="s">"Value-222"</span><span class="o">,</span> <span class="s">"Value-333"</span><span class="o">,</span> <span class="s">"Value-444"</span><span class="o">,</span> <span class="s">"Value-555"</span><span class="o">,</span>
                        <span class="s">"Value-666"</span><span class="o">));</span>

        <span class="c1">// 4. Apply the filter provider to the list</span>
        <span class="kd">final</span> <span class="nc">MappingJacksonValue</span> <span class="n">mappingJacksonValue</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">MappingJacksonValue</span><span class="o">(</span><span class="nc">SomeBeanDynamicFilterList</span><span class="o">);</span>
        <span class="n">mappingJacksonValue</span><span class="o">.</span><span class="na">setFilters</span><span class="o">(</span><span class="n">simpleFilterProvider</span><span class="o">);</span>

        <span class="k">return</span> <span class="n">mappingJacksonValue</span><span class="o">;</span> <span class="c1">// Returns only field1, field3, field5, field6</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div><h3 id="project-poc">Project POC</h3><ul><li>You can refer to the following GitHub application for a practical demonstration of static content filtering: <a href="https://github.com/SRVivek1/springboot-microservices-2024/tree/main/a9-sboot-ms-static-filtering">Spring Boot POC App - Static Filtering</a></li></ul><hr/><h2 id="-observations-and-insights">üîç Observations and Insights</h2><ul><li><strong>Dynamic Filtering Defined:</strong> This approach is called <strong>Dynamic Filtering</strong> because the set of properties to include/exclude is determined at <strong>runtime</strong> within the controller method for the specific API call.</li><li><strong><code class="language-plaintext highlighter-rouge">@JsonFilter</code> Annotation:</strong> It serves as a <strong>marker</strong> on the Java Bean, defining a unique <code class="language-plaintext highlighter-rouge">filter name</code> (<code class="language-plaintext highlighter-rouge">"dyna-filter-for-somebean"</code>). Jackson will look for a <code class="language-plaintext highlighter-rouge">FilterProvider</code> registered with this exact name when serializing this bean.</li><li><strong><code class="language-plaintext highlighter-rouge">MappingJacksonValue</code>:</strong> This Spring utility class is essential. It wraps the response object (Bean/List) and allows the attachment of a <strong><code class="language-plaintext highlighter-rouge">FilterProvider</code></strong> to be used specifically for the serialization of <em>that</em> response, overriding the default serialization behavior.</li></ul><hr/><h2 id="-expert-advice-what-engineers-should-be-aware-of">üí° Expert Advice: What Engineers Should Be Aware Of</h2><p>Engineers should consider <strong>request-based filtering</strong> as a better long-term solution. Allowing clients to specify which fields they need (e.g., using a <strong><code class="language-plaintext highlighter-rouge">fields</code> query parameter</strong> like <code class="language-plaintext highlighter-rouge">/api/users?fields=id,name</code>) puts the burden of filtering on the client, which is ideal for high-traffic, generic APIs. This involves:</p><ol><li>Reading the <code class="language-plaintext highlighter-rouge">fields</code> query parameter in the controller.</li><li>Dynamically creating the <code class="language-plaintext highlighter-rouge">SimpleBeanPropertyFilter</code> based on the requested fields.</li><li>Applying the filter via <code class="language-plaintext highlighter-rouge">MappingJacksonValue</code>, as shown above.</li></ol><p>This makes your API more <strong>performant</strong> and allows consumers to prevent <strong>over-fetching</strong> data.</p><hr/><h2 id="Ô∏è-architecture-diagram">üèóÔ∏è Architecture Diagram</h2><p>This sequence diagram illustrates how the dynamic filtering process works when a request is made to a filtered endpoint.</p><pre><code class="language-mermaid">sequenceDiagram
    participant Client
    participant Controller
    participant JacksonMapper
    participant ResponseBean

    Client-&gt;&gt;Controller: GET /dyna-filtering
    Controller-&gt;&gt;Controller: 1. Create SimpleBeanPropertyFilter (e.g., keep field2, field4, field6)
    Controller-&gt;&gt;Controller: 2. Create SimpleFilterProvider &amp; register filter ("dyna-filter-for-somebean")
    Controller-&gt;&gt;ResponseBean: 3. Instantiate SomeBeanDynamicFilter
    Controller-&gt;&gt;Controller: 4. Wrap Bean in MappingJacksonValue &amp; set Filters
    Controller-&gt;&gt;JacksonMapper: Serialize(MappingJacksonValue)
    JacksonMapper-&gt;&gt;JacksonMapper: Check @JsonFilter on ResponseBean
    JacksonMapper-&gt;&gt;JacksonMapper: Retrieve filter from SimpleFilterProvider
    JacksonMapper-&gt;&gt;Client: 5. Return Filtered JSON Response (only field2, field4, field6)
</code></pre><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code></code></pre></div></div></div></main></div></div><script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script><script src="/geekmonks/assets/js/mermaid-diagram-render.js?v=0.1.0"></script><script src="/geekmonks/assets/js/submenu-togle.js?v=0.1.0"></script></body></html>