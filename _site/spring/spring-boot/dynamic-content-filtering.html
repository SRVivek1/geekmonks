<h1>Dynamic content filtering</h1>

<p>
  Updated on: 
  
  
  
    - <a href="/geekmonks/authors/srvivek/">Vivek Singh</a>
  
</p>

<hr/>

<h3 id="project-ref-a9-sboot-ms-static-filtering">Project ref: <a href="https://github.com/SRVivek1/springboot-microservices-2024/tree/main/a9-sboot-ms-static-filtering">a9-sboot-ms-static-filtering</a></h3>
<ul>
  <li><strong><ins>Purpose / Feature</ins></strong>
    <ul>
      <li>Content filtering refers to removing the properties from Response bean when sending back to requestor.</li>
      <li>This feature is available in <code class="language-plaintext highlighter-rouge">jackson-annotations-x.x.jar</code>, which is added as part of <code class="language-plaintext highlighter-rouge">spring-boot-starter-web</code> dependency.</li>
    </ul>
  </li>
  <li><strong><ins>Maven / External dependency</ins></strong>
    <ul>
      <li>Add spring validation dependency.
 	```xml
	<dependency>
        <groupId>org.springframework.boot</groupId>
        <artifactId>spring-boot-starter-web</artifactId>
    </dependency></li>
    </ul>
  </li>
  <li><strong><ins>Code changes</ins></strong>
    <ul>
      <li>Bean
        <ul>
          <li>Update the Java Bean class with the <code class="language-plaintext highlighter-rouge">filter name</code> create inside controller.</li>
          <li>All controller APIs should update the filter with same <code class="language-plaintext highlighter-rouge">filter name</code>.</li>
          <li>imports
            <ul>
              <li><code class="language-plaintext highlighter-rouge">import com.fasterxml.jackson.annotation.JsonFilter;</code></li>
            </ul>
          </li>
          <li>Annotate java properties to ignore while building the response.
            <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="cm">/** Dynamically exclude properties as per the specified filter set by the API. */</span>
    <span class="nd">@JsonFilter</span><span class="o">(</span><span class="s">"dyna-filter-for-somebean"</span><span class="o">)</span>
  <span class="kd">public</span> <span class="kd">class</span> <span class="nc">SomeBeanDynamicFilter</span> <span class="o">{</span>

      <span class="kd">private</span> <span class="nc">String</span> <span class="n">field1</span><span class="o">;</span>
      <span class="kd">private</span> <span class="nc">String</span> <span class="n">field2</span><span class="o">;</span>
      <span class="kd">private</span> <span class="nc">String</span> <span class="n">field3</span><span class="o">;</span>
      <span class="kd">private</span> <span class="nc">String</span> <span class="n">field4</span><span class="o">;</span>
      <span class="kd">private</span> <span class="nc">String</span> <span class="n">field5</span><span class="o">;</span>
      <span class="kd">private</span> <span class="nc">String</span> <span class="n">field6</span><span class="o">;</span>

        <span class="c1">// constructors, setter-getters and utility methods</span>
    <span class="o">}</span>
</code></pre></div>            </div>
          </li>
        </ul>
      </li>
      <li>Controller
        <ul>
          <li>Create instace of `` and mention the properties to be excluded and add it with a unique name in filter provider.</li>
          <li>imports
            <ul>
              <li><code class="language-plaintext highlighter-rouge">import com.fasterxml.jackson.databind.ser.FilterProvider;</code></li>
              <li><code class="language-plaintext highlighter-rouge">import com.fasterxml.jackson.databind.ser.impl.SimpleBeanPropertyFilter;</code></li>
              <li><code class="language-plaintext highlighter-rouge">import com.fasterxml.jackson.databind.ser.impl.SimpleFilterProvider;</code></li>
              <li><code class="language-plaintext highlighter-rouge">import com.srvivek.sboot.mservices.bean.SomeBeanDynamicFilter;</code></li>
            </ul>
          </li>
          <li>Create filter.
            <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="nd">@RestController</span>
  <span class="kd">public</span> <span class="kd">class</span> <span class="nc">DynamicFilteringController</span> <span class="o">{</span>

      <span class="nd">@GetMapping</span><span class="o">(</span><span class="s">"/dyna-filtering"</span><span class="o">)</span>
      <span class="kd">public</span> <span class="nc">MappingJacksonValue</span> <span class="nf">filtering</span><span class="o">()</span> <span class="o">{</span>

          <span class="c1">// Dynamic filtering</span>
          <span class="kd">final</span> <span class="nc">SimpleBeanPropertyFilter</span> <span class="n">simpleBeanPropertyFilter</span> <span class="o">=</span> <span class="nc">SimpleBeanPropertyFilter</span><span class="o">.</span><span class="na">filterOutAllExcept</span><span class="o">(</span><span class="s">"field2"</span><span class="o">,</span>
                  <span class="s">"field4"</span><span class="o">,</span> <span class="s">"field6"</span><span class="o">);</span>

          <span class="kd">final</span> <span class="nc">SimpleFilterProvider</span> <span class="n">simpleFilterProvider</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">SimpleFilterProvider</span><span class="o">()</span>
                  <span class="o">.</span><span class="na">addFilter</span><span class="o">(</span><span class="s">"dyna-filter-for-somebean"</span><span class="o">,</span> <span class="n">simpleBeanPropertyFilter</span><span class="o">);</span>

          <span class="c1">// Construct resposnse bean</span>
          <span class="kd">final</span> <span class="nc">SomeBeanDynamicFilter</span> <span class="nc">SomeBeanDynamicFilter</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">SomeBeanDynamicFilter</span><span class="o">(</span><span class="s">"Value-1"</span><span class="o">,</span> <span class="s">"Value-2"</span><span class="o">,</span> <span class="s">"Value-3"</span><span class="o">,</span>
                  <span class="s">"Value-4"</span><span class="o">,</span> <span class="s">"Value-5"</span><span class="o">,</span> <span class="s">"Value-6"</span><span class="o">);</span>
          <span class="kd">final</span> <span class="nc">MappingJacksonValue</span> <span class="n">mappingJacksonValue</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">MappingJacksonValue</span><span class="o">(</span><span class="nc">SomeBeanDynamicFilter</span><span class="o">);</span>
          <span class="n">mappingJacksonValue</span><span class="o">.</span><span class="na">setFilters</span><span class="o">(</span><span class="n">simpleFilterProvider</span><span class="o">);</span>

          <span class="k">return</span> <span class="n">mappingJacksonValue</span><span class="o">;</span>
      <span class="o">}</span>

      <span class="nd">@GetMapping</span><span class="o">(</span><span class="s">"/dyna-filtering-list"</span><span class="o">)</span>
      <span class="kd">public</span> <span class="nc">MappingJacksonValue</span> <span class="nf">filteringList</span><span class="o">()</span> <span class="o">{</span>

          <span class="c1">// Dynamic filtering</span>
          <span class="nc">SimpleBeanPropertyFilter</span> <span class="n">simpleBeanPropertyFilter</span> <span class="o">=</span> <span class="nc">SimpleBeanPropertyFilter</span><span class="o">.</span><span class="na">filterOutAllExcept</span><span class="o">(</span><span class="s">"field1"</span><span class="o">,</span>
                  <span class="s">"field3"</span><span class="o">,</span> <span class="s">"field5"</span><span class="o">,</span> <span class="s">"field6"</span><span class="o">);</span>
          <span class="nc">FilterProvider</span> <span class="n">simpleFilterProvider</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">SimpleFilterProvider</span><span class="o">().</span><span class="na">addFilter</span><span class="o">(</span><span class="s">"dyna-filter-for-somebean"</span><span class="o">,</span>
                  <span class="n">simpleBeanPropertyFilter</span><span class="o">);</span>

          <span class="c1">// Construct list of resposnse beans</span>
          <span class="nc">List</span><span class="o">&lt;</span><span class="nc">SomeBeanDynamicFilter</span><span class="o">&gt;</span> <span class="nc">SomeBeanDynamicFilterList</span> <span class="o">=</span> <span class="nc">Arrays</span><span class="o">.</span><span class="na">asList</span><span class="o">(</span>
                  <span class="k">new</span> <span class="nf">SomeBeanDynamicFilter</span><span class="o">(</span><span class="s">"Value-1"</span><span class="o">,</span> <span class="s">"Value-2"</span><span class="o">,</span> <span class="s">"Value-3"</span><span class="o">,</span> <span class="s">"Value-4"</span><span class="o">,</span> <span class="s">"Value-5"</span><span class="o">,</span> <span class="s">"Value-6"</span><span class="o">),</span>
                  <span class="k">new</span> <span class="nf">SomeBeanDynamicFilter</span><span class="o">(</span><span class="s">"Value-11"</span><span class="o">,</span> <span class="s">"Value-22"</span><span class="o">,</span> <span class="s">"Value-33"</span><span class="o">,</span> <span class="s">"Value-44"</span><span class="o">,</span> <span class="s">"Value-55"</span><span class="o">,</span> <span class="s">"Value-66"</span><span class="o">),</span>
                  <span class="k">new</span> <span class="nf">SomeBeanDynamicFilter</span><span class="o">(</span><span class="s">"Value-111"</span><span class="o">,</span> <span class="s">"Value-222"</span><span class="o">,</span> <span class="s">"Value-333"</span><span class="o">,</span> <span class="s">"Value-444"</span><span class="o">,</span> <span class="s">"Value-555"</span><span class="o">,</span>
                          <span class="s">"Value-666"</span><span class="o">));</span>

          <span class="kd">final</span> <span class="nc">MappingJacksonValue</span> <span class="n">mappingJacksonValue</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">MappingJacksonValue</span><span class="o">(</span><span class="nc">SomeBeanDynamicFilterList</span><span class="o">);</span>
          <span class="n">mappingJacksonValue</span><span class="o">.</span><span class="na">setFilters</span><span class="o">(</span><span class="n">simpleFilterProvider</span><span class="o">);</span>

          <span class="k">return</span> <span class="n">mappingJacksonValue</span><span class="o">;</span>
      <span class="o">}</span>
  <span class="o">}</span>
</code></pre></div>            </div>
          </li>
        </ul>
      </li>
    </ul>
  </li>
  <li><strong><ins>Notes:</ins></strong>
    <ul>
      <li>In this approach weâ€™re dynamically marking the properties which should not be returned in response when the given bean is returned in response, for the API which is returring this bean.</li>
      <li>Hence, this is called <code class="language-plaintext highlighter-rouge">Dynamic Filtering</code>.</li>
      <li><code class="language-plaintext highlighter-rouge">@JsonFilter</code> annotation:
        <ul>
          <li>Defines a filter name, which should be evaluated and applied every time when object of this bean is returned in response.</li>
          <li>The given filter name <code class="language-plaintext highlighter-rouge">dyna-filter-for-somebean</code> is created and update in API method of controller class.</li>
        </ul>
      </li>
    </ul>
  </li>
</ul>


<!-- TODO: add footer -->